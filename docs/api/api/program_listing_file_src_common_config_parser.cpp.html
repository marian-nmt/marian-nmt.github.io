

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Program Listing for File config_parser.cpp &mdash; Marian NMT v1.10.2 2021-02-28 documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/custom.css" type="text/css" />
  <link rel="stylesheet" href="../_static/collapsible-lists/css/tree_view.css" type="text/css" />

  
  

  
  

  
    <link rel="canonical" href="http://marian-nmt.github.io/docs/api/api/program_listing_file_src_common_config_parser.cpp.html" />

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/language_data.js"></script>
        <script src="../_static/collapsible-lists/js/CollapsibleLists.compressed.js"></script>
        <script src="../_static/collapsible-lists/js/apply-collapsible-lists.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> Marian NMT
          

          
          </a>

          
            
            
              <div class="version">
                v1.10.2
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../graph.html">Expression graphs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../operators.html">Operations in the Expression Graph</a></li>
<li class="toctree-l1"><a class="reference internal" href="library_index.html">Library API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contributing.html">How to contribute to Marian</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Marian NMT</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Program Listing for File config_parser.cpp</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/api/program_listing_file_src_common_config_parser.cpp.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="program-listing-for-file-config-parser-cpp">
<span id="program-listing-file-src-common-config-parser-cpp"></span><h1>Program Listing for File config_parser.cpp<a class="headerlink" href="#program-listing-for-file-config-parser-cpp" title="Permalink to this headline">¶</a></h1>
<p>↰ <a class="reference internal" href="file_src_common_config_parser.cpp.html#file-src-common-config-parser-cpp"><span class="std std-ref">Return to documentation for file</span></a> (<code class="docutils literal notranslate"><span class="pre">src/common/config_parser.cpp</span></code>)</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&quot;common/authors.h&quot;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&quot;common/build_info.h&quot;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&quot;common/cli_helper.h&quot;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&quot;common/config.h&quot;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&quot;common/config_parser.h&quot;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&quot;common/config_validator.h&quot;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&quot;common/definitions.h&quot;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&quot;common/file_stream.h&quot;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&quot;common/logging.h&quot;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&quot;common/options.h&quot;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&quot;common/regex.h&quot;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&quot;common/utils.h&quot;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;algorithm&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;set&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;stdexcept&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;string&gt;</span><span class="cp"></span>

<span class="cp">#if MKL_FOUND</span>
<span class="cp">#include</span> <span class="cpf">&lt;mkl.h&gt;</span><span class="cp"></span>
<span class="cp">#else</span>
<span class="cp">#if BLAS_FOUND</span>
<span class="cp">#include</span> <span class="cpf">&lt;cblas.h&gt;</span><span class="cp"></span>
<span class="cp">#endif</span>
<span class="cp">#endif</span>

<span class="k">namespace</span> <span class="n">marian</span> <span class="p">{</span>

<span class="c1">// TODO: Move this to CLIWrapper and allow to mark options as paths in the same place they are</span>
<span class="c1">// defined</span>
<span class="c1">// clang-format off</span>
<span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">set</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span> <span class="n">PATHS</span> <span class="o">=</span> <span class="p">{</span>
  <span class="s">&quot;model&quot;</span><span class="p">,</span>
  <span class="s">&quot;models&quot;</span><span class="p">,</span>
  <span class="s">&quot;train-sets&quot;</span><span class="p">,</span>
  <span class="s">&quot;vocabs&quot;</span><span class="p">,</span>
  <span class="s">&quot;embedding-vectors&quot;</span><span class="p">,</span>
  <span class="s">&quot;valid-sets&quot;</span><span class="p">,</span>
  <span class="s">&quot;valid-script-path&quot;</span><span class="p">,</span>
  <span class="s">&quot;valid-script-args&quot;</span><span class="p">,</span>
  <span class="s">&quot;valid-log&quot;</span><span class="p">,</span>
  <span class="s">&quot;valid-translation-output&quot;</span><span class="p">,</span>
  <span class="s">&quot;input&quot;</span><span class="p">,</span>            <span class="c1">// except: &#39;stdin&#39;, handled in makeAbsolutePaths and interpolateEnvVars</span>
  <span class="s">&quot;output&quot;</span><span class="p">,</span>           <span class="c1">// except: &#39;stdout&#39;, handled in makeAbsolutePaths and interpolateEnvVars</span>
  <span class="s">&quot;pretrained-model&quot;</span><span class="p">,</span>
  <span class="s">&quot;data-weighting&quot;</span><span class="p">,</span>
  <span class="s">&quot;log&quot;</span><span class="p">,</span>
  <span class="s">&quot;sqlite&quot;</span><span class="p">,</span>           <span class="c1">// except: &#39;temporary&#39;, handled in the processPaths function</span>
  <span class="s">&quot;shortlist&quot;</span><span class="p">,</span>        <span class="c1">// except: only the first element in the sequence is a path, handled in the</span>
                      <span class="c1">//  processPaths function</span>
<span class="p">};</span>
<span class="c1">// clang-format on</span>

<span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">escapeCmdLine</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span><span class="o">**</span> <span class="n">argv</span><span class="p">){</span>
  <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">cmdLine</span><span class="p">;</span>
  <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">argc</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">arg</span> <span class="o">=</span> <span class="n">argv</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
    <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">quote</span><span class="p">;</span> <span class="c1">// attempt to quote special chars</span>
    <span class="k">if</span><span class="p">(</span><span class="n">arg</span><span class="p">.</span><span class="n">empty</span><span class="p">()</span> <span class="o">||</span> <span class="n">arg</span><span class="p">.</span><span class="n">find_first_of</span><span class="p">(</span><span class="s">&quot; #`</span><span class="se">\&quot;</span><span class="s">&#39;</span><span class="se">\\</span><span class="s">${}|&amp;^?*!()%&gt;&lt;&quot;</span><span class="p">)</span> <span class="o">!=</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">::</span><span class="n">npos</span><span class="p">)</span>
      <span class="n">quote</span> <span class="o">=</span> <span class="s">&quot;&#39;&quot;</span><span class="p">;</span>
    <span class="n">arg</span> <span class="o">=</span> <span class="n">regex</span><span class="o">::</span><span class="n">regex_replace</span><span class="p">(</span><span class="n">arg</span><span class="p">,</span> <span class="n">regex</span><span class="o">::</span><span class="n">regex</span><span class="p">(</span><span class="s">&quot;&#39;&quot;</span><span class="p">),</span> <span class="s">&quot;&#39;</span><span class="se">\\</span><span class="s">&#39;&#39;&quot;</span><span class="p">);</span>
    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">cmdLine</span><span class="p">.</span><span class="n">empty</span><span class="p">())</span>
      <span class="n">cmdLine</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="sc">&#39; &#39;</span><span class="p">);</span>
    <span class="n">cmdLine</span> <span class="o">+=</span> <span class="n">quote</span> <span class="o">+</span> <span class="n">arg</span> <span class="o">+</span> <span class="n">quote</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="n">cmdLine</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="k">const</span><span class="o">&amp;</span> <span class="n">ConfigParser</span><span class="o">::</span><span class="n">cmdLine</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span>
  <span class="k">return</span> <span class="n">cmdLine_</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">ConfigParser</span><span class="o">::</span><span class="n">ConfigParser</span><span class="p">(</span><span class="n">cli</span><span class="o">::</span><span class="n">mode</span> <span class="n">mode</span><span class="p">)</span>
  <span class="o">:</span> <span class="n">cli_</span><span class="p">(</span><span class="n">config_</span><span class="p">,</span><span class="s">&quot;Marian: Fast Neural Machine Translation in C++&quot;</span><span class="p">,</span>
         <span class="s">&quot;General options&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="mi">40</span><span class="p">),</span>
    <span class="n">mode_</span><span class="p">(</span><span class="n">mode</span> <span class="o">==</span> <span class="n">cli</span><span class="o">::</span><span class="n">mode</span><span class="o">::</span><span class="n">server</span> <span class="o">?</span> <span class="n">cli</span><span class="o">::</span><span class="n">mode</span><span class="o">::</span><span class="nl">translation</span> <span class="p">:</span> <span class="n">mode</span><span class="p">)</span> <span class="p">{</span>

  <span class="n">addOptionsGeneral</span><span class="p">(</span><span class="n">cli_</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">mode</span> <span class="o">==</span> <span class="n">cli</span><span class="o">::</span><span class="n">mode</span><span class="o">::</span><span class="n">server</span><span class="p">)</span>
    <span class="n">addOptionsServer</span><span class="p">(</span><span class="n">cli_</span><span class="p">);</span>
  <span class="n">addOptionsModel</span><span class="p">(</span><span class="n">cli_</span><span class="p">);</span>

  <span class="c1">// clang-format off</span>
  <span class="k">switch</span><span class="p">(</span><span class="n">mode_</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">case</span> <span class="n">cli</span><span class="o">::</span><span class="n">mode</span><span class="o">::</span><span class="nl">training</span><span class="p">:</span>
      <span class="n">addOptionsTraining</span><span class="p">(</span><span class="n">cli_</span><span class="p">);</span>
      <span class="n">addOptionsValidation</span><span class="p">(</span><span class="n">cli_</span><span class="p">);</span>
      <span class="k">break</span><span class="p">;</span>
    <span class="k">case</span> <span class="n">cli</span><span class="o">::</span><span class="n">mode</span><span class="o">::</span><span class="nl">translation</span><span class="p">:</span>
      <span class="n">addOptionsTranslation</span><span class="p">(</span><span class="n">cli_</span><span class="p">);</span>
      <span class="k">break</span><span class="p">;</span>
    <span class="k">case</span> <span class="n">cli</span><span class="o">::</span><span class="n">mode</span><span class="o">::</span><span class="nl">scoring</span><span class="p">:</span>
      <span class="n">addOptionsScoring</span><span class="p">(</span><span class="n">cli_</span><span class="p">);</span>
      <span class="k">break</span><span class="p">;</span>
    <span class="k">case</span> <span class="n">cli</span><span class="o">::</span><span class="n">mode</span><span class="o">::</span><span class="nl">embedding</span><span class="p">:</span>
      <span class="n">addOptionsEmbedding</span><span class="p">(</span><span class="n">cli_</span><span class="p">);</span>
      <span class="k">break</span><span class="p">;</span>
    <span class="k">default</span><span class="o">:</span>
      <span class="n">ABORT</span><span class="p">(</span><span class="s">&quot;wrong CLI mode&quot;</span><span class="p">);</span>
      <span class="k">break</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="n">addAliases</span><span class="p">(</span><span class="n">cli_</span><span class="p">);</span>
  <span class="c1">// clang-format on</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">ConfigParser</span><span class="o">::</span><span class="n">addOptionsGeneral</span><span class="p">(</span><span class="n">cli</span><span class="o">::</span><span class="n">CLIWrapper</span><span class="o">&amp;</span> <span class="n">cli</span><span class="p">)</span> <span class="p">{</span>
  <span class="kt">int</span> <span class="n">defaultWorkspace</span> <span class="o">=</span> <span class="p">(</span><span class="n">mode_</span> <span class="o">==</span> <span class="n">cli</span><span class="o">::</span><span class="n">mode</span><span class="o">::</span><span class="n">translation</span><span class="p">)</span> <span class="o">?</span> <span class="mi">512</span> <span class="o">:</span> <span class="mi">2048</span><span class="p">;</span>

  <span class="n">cli</span><span class="p">.</span><span class="n">switchGroup</span><span class="p">(</span><span class="s">&quot;General options&quot;</span><span class="p">);</span>

  <span class="c1">// clang-format off</span>
  <span class="n">cli</span><span class="p">.</span><span class="n">add</span><span class="o">&lt;</span><span class="kt">bool</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;--authors&quot;</span><span class="p">,</span>
    <span class="s">&quot;Print list of authors and exit&quot;</span><span class="p">);</span>
  <span class="n">cli</span><span class="p">.</span><span class="n">add</span><span class="o">&lt;</span><span class="kt">bool</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;--cite&quot;</span><span class="p">,</span>
    <span class="s">&quot;Print citation and exit&quot;</span><span class="p">);</span>
  <span class="n">cli</span><span class="p">.</span><span class="n">add</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;--build-info&quot;</span><span class="p">,</span>
    <span class="s">&quot;Print CMake build options and exit. Set to &#39;all&#39; to print advanced options&quot;</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="n">implicit_val</span><span class="p">(</span><span class="s">&quot;basic&quot;</span><span class="p">);</span>
  <span class="n">cli</span><span class="p">.</span><span class="n">add</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;&gt;</span><span class="p">(</span><span class="s">&quot;--config,-c&quot;</span><span class="p">,</span>
    <span class="s">&quot;Configuration file(s). If multiple, later overrides earlier&quot;</span><span class="p">);</span>
  <span class="n">cli</span><span class="p">.</span><span class="n">add</span><span class="o">&lt;</span><span class="kt">size_t</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;--workspace,-w&quot;</span><span class="p">,</span>
    <span class="s">&quot;Preallocate  arg  MB of work space&quot;</span><span class="p">,</span>
    <span class="n">defaultWorkspace</span><span class="p">);</span>
  <span class="n">cli</span><span class="p">.</span><span class="n">add</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;--log&quot;</span><span class="p">,</span>
    <span class="s">&quot;Log training process information to file given by  arg&quot;</span><span class="p">);</span>
  <span class="n">cli</span><span class="p">.</span><span class="n">add</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;--log-level&quot;</span><span class="p">,</span>
    <span class="s">&quot;Set verbosity level of logging: trace, debug, info, warn, err(or), critical, off&quot;</span><span class="p">,</span>
    <span class="s">&quot;info&quot;</span><span class="p">);</span>
  <span class="n">cli</span><span class="p">.</span><span class="n">add</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;--log-time-zone&quot;</span><span class="p">,</span>
    <span class="s">&quot;Set time zone for the date shown on logging&quot;</span><span class="p">);</span>
  <span class="n">cli</span><span class="p">.</span><span class="n">add</span><span class="o">&lt;</span><span class="kt">bool</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;--quiet&quot;</span><span class="p">,</span>
    <span class="s">&quot;Suppress all logging to stderr. Logging to files still works&quot;</span><span class="p">);</span>
  <span class="n">cli</span><span class="p">.</span><span class="n">add</span><span class="o">&lt;</span><span class="kt">bool</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;--quiet-translation&quot;</span><span class="p">,</span>
    <span class="s">&quot;Suppress logging for translation&quot;</span><span class="p">);</span>
  <span class="n">cli</span><span class="p">.</span><span class="n">add</span><span class="o">&lt;</span><span class="kt">size_t</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;--seed&quot;</span><span class="p">,</span>
    <span class="s">&quot;Seed for all random number generators. 0 means initialize randomly&quot;</span><span class="p">);</span>
  <span class="n">cli</span><span class="p">.</span><span class="n">add</span><span class="o">&lt;</span><span class="kt">bool</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;--interpolate-env-vars&quot;</span><span class="p">,</span>
    <span class="s">&quot;allow the use of environment variables in paths, of the form ${VAR_NAME}&quot;</span><span class="p">);</span>
  <span class="n">cli</span><span class="p">.</span><span class="n">add</span><span class="o">&lt;</span><span class="kt">bool</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;--relative-paths&quot;</span><span class="p">,</span>
    <span class="s">&quot;All paths are relative to the config file location&quot;</span><span class="p">);</span>
  <span class="n">cli</span><span class="p">.</span><span class="n">add</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;--dump-config&quot;</span><span class="p">,</span>
    <span class="s">&quot;Dump current (modified) configuration to stdout and exit. Possible values: full, minimal, expand&quot;</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="n">implicit_val</span><span class="p">(</span><span class="s">&quot;full&quot;</span><span class="p">);</span>
  <span class="k">if</span><span class="p">(</span><span class="n">mode_</span> <span class="o">==</span> <span class="n">cli</span><span class="o">::</span><span class="n">mode</span><span class="o">::</span><span class="n">training</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// --sigterm is deliberately not a boolean, to allow for a consistent</span>
    <span class="c1">// pattern of specifying custom signal handling in the future.</span>
    <span class="c1">// (e.g., dump model but continue training upon SIGUSR1, or report current</span>
    <span class="c1">// training status upon SIGINFO.)</span>
    <span class="n">cli</span><span class="p">.</span><span class="n">add</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;--sigterm&quot;</span><span class="p">,</span>
      <span class="s">&quot;What to do with SIGTERM: save-and-exit or exit-immediately.&quot;</span><span class="p">,</span>
      <span class="s">&quot;save-and-exit&quot;</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="c1">// clang-format on</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">ConfigParser</span><span class="o">::</span><span class="n">addOptionsServer</span><span class="p">(</span><span class="n">cli</span><span class="o">::</span><span class="n">CLIWrapper</span><span class="o">&amp;</span> <span class="n">cli</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// clang-format off</span>
  <span class="k">auto</span> <span class="n">previous_group</span> <span class="o">=</span> <span class="n">cli</span><span class="p">.</span><span class="n">switchGroup</span><span class="p">(</span><span class="s">&quot;Server options&quot;</span><span class="p">);</span>
  <span class="n">cli</span><span class="p">.</span><span class="n">add</span><span class="o">&lt;</span><span class="kt">size_t</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;--port,-p&quot;</span><span class="p">,</span>
      <span class="s">&quot;Port number for web socket server&quot;</span><span class="p">,</span>
      <span class="mi">8080</span><span class="p">);</span>
  <span class="n">cli</span><span class="p">.</span><span class="n">switchGroup</span><span class="p">(</span><span class="n">previous_group</span><span class="p">);</span>
  <span class="c1">// clang-format on</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">ConfigParser</span><span class="o">::</span><span class="n">addOptionsModel</span><span class="p">(</span><span class="n">cli</span><span class="o">::</span><span class="n">CLIWrapper</span><span class="o">&amp;</span> <span class="n">cli</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">auto</span> <span class="n">previous_group</span> <span class="o">=</span> <span class="n">cli</span><span class="p">.</span><span class="n">switchGroup</span><span class="p">(</span><span class="s">&quot;Model options&quot;</span><span class="p">);</span>

  <span class="c1">// clang-format off</span>
  <span class="k">if</span><span class="p">(</span><span class="n">mode_</span> <span class="o">==</span> <span class="n">cli</span><span class="o">::</span><span class="n">mode</span><span class="o">::</span><span class="n">translation</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">cli</span><span class="p">.</span><span class="n">add</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;&gt;</span><span class="p">(</span><span class="s">&quot;--models,-m&quot;</span><span class="p">,</span>
      <span class="s">&quot;Paths to model(s) to be loaded. Supported file extensions: .npz, .bin&quot;</span><span class="p">);</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="n">cli</span><span class="p">.</span><span class="n">add</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;--model,-m&quot;</span><span class="p">,</span>
      <span class="s">&quot;Path prefix for model to be saved/resumed. Supported file extensions: .npz, .bin&quot;</span><span class="p">,</span>
      <span class="s">&quot;model.npz&quot;</span><span class="p">);</span>

    <span class="k">if</span><span class="p">(</span><span class="n">mode_</span> <span class="o">==</span> <span class="n">cli</span><span class="o">::</span><span class="n">mode</span><span class="o">::</span><span class="n">training</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">cli</span><span class="p">.</span><span class="n">add</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;--pretrained-model&quot;</span><span class="p">,</span>
        <span class="s">&quot;Path prefix for pre-trained model to initialize model weights&quot;</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="n">cli</span><span class="p">.</span><span class="n">add</span><span class="o">&lt;</span><span class="kt">bool</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;--ignore-model-config&quot;</span><span class="p">,</span>
      <span class="s">&quot;Ignore the model configuration saved in npz file&quot;</span><span class="p">);</span>
  <span class="n">cli</span><span class="p">.</span><span class="n">add</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;--type&quot;</span><span class="p">,</span>
      <span class="s">&quot;Model type: amun, nematus, s2s, multi-s2s, transformer&quot;</span><span class="p">,</span>
      <span class="s">&quot;amun&quot;</span><span class="p">);</span>
  <span class="n">cli</span><span class="p">.</span><span class="n">add</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;&gt;</span><span class="p">(</span><span class="s">&quot;--dim-vocabs&quot;</span><span class="p">,</span>
      <span class="s">&quot;Maximum items in vocabulary ordered by rank, 0 uses all items in the provided/created vocabulary file&quot;</span><span class="p">,</span>
      <span class="p">{</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">});</span>
  <span class="n">cli</span><span class="p">.</span><span class="n">add</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;--dim-emb&quot;</span><span class="p">,</span>
      <span class="s">&quot;Size of embedding vector&quot;</span><span class="p">,</span>
      <span class="mi">512</span><span class="p">);</span>
  <span class="n">cli</span><span class="p">.</span><span class="n">add</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;--lemma-dim-emb&quot;</span><span class="p">,</span>
      <span class="s">&quot;Re-embedding dimension of lemma in factors&quot;</span><span class="p">,</span>
      <span class="mi">0</span><span class="p">);</span>
  <span class="n">cli</span><span class="p">.</span><span class="n">add</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;--dim-rnn&quot;</span><span class="p">,</span>
      <span class="s">&quot;Size of rnn hidden state&quot;</span><span class="p">,</span> <span class="mi">1024</span><span class="p">);</span>
  <span class="n">cli</span><span class="p">.</span><span class="n">add</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;--enc-type&quot;</span><span class="p">,</span>
      <span class="s">&quot;Type of encoder RNN : bidirectional, bi-unidirectional, alternating (s2s)&quot;</span><span class="p">,</span>
      <span class="s">&quot;bidirectional&quot;</span><span class="p">);</span>
  <span class="n">cli</span><span class="p">.</span><span class="n">add</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;--enc-cell&quot;</span><span class="p">,</span>
      <span class="s">&quot;Type of RNN cell: gru, lstm, tanh (s2s)&quot;</span><span class="p">,</span> <span class="s">&quot;gru&quot;</span><span class="p">);</span>
  <span class="n">cli</span><span class="p">.</span><span class="n">add</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;--enc-cell-depth&quot;</span><span class="p">,</span>
      <span class="s">&quot;Number of transitional cells in encoder layers (s2s)&quot;</span><span class="p">,</span>
      <span class="mi">1</span><span class="p">);</span>
  <span class="n">cli</span><span class="p">.</span><span class="n">add</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;--enc-depth&quot;</span><span class="p">,</span>
      <span class="s">&quot;Number of encoder layers (s2s)&quot;</span><span class="p">,</span>
      <span class="mi">1</span><span class="p">);</span>
  <span class="n">cli</span><span class="p">.</span><span class="n">add</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;--dec-cell&quot;</span><span class="p">,</span>
      <span class="s">&quot;Type of RNN cell: gru, lstm, tanh (s2s)&quot;</span><span class="p">,</span>
      <span class="s">&quot;gru&quot;</span><span class="p">);</span>
  <span class="n">cli</span><span class="p">.</span><span class="n">add</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;--dec-cell-base-depth&quot;</span><span class="p">,</span>
      <span class="s">&quot;Number of transitional cells in first decoder layer (s2s)&quot;</span><span class="p">,</span>
      <span class="mi">2</span><span class="p">);</span>
  <span class="n">cli</span><span class="p">.</span><span class="n">add</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;--dec-cell-high-depth&quot;</span><span class="p">,</span>
      <span class="s">&quot;Number of transitional cells in next decoder layers (s2s)&quot;</span><span class="p">,</span>
      <span class="mi">1</span><span class="p">);</span>
  <span class="n">cli</span><span class="p">.</span><span class="n">add</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;--dec-depth&quot;</span><span class="p">,</span>
      <span class="s">&quot;Number of decoder layers (s2s)&quot;</span><span class="p">,</span>
      <span class="mi">1</span><span class="p">);</span>
  <span class="n">cli</span><span class="p">.</span><span class="n">add</span><span class="o">&lt;</span><span class="kt">bool</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;--skip&quot;</span><span class="p">,</span>
      <span class="s">&quot;Use skip connections (s2s)&quot;</span><span class="p">);</span>
  <span class="n">cli</span><span class="p">.</span><span class="n">add</span><span class="o">&lt;</span><span class="kt">bool</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;--layer-normalization&quot;</span><span class="p">,</span>
      <span class="s">&quot;Enable layer normalization&quot;</span><span class="p">);</span>
  <span class="n">cli</span><span class="p">.</span><span class="n">add</span><span class="o">&lt;</span><span class="kt">bool</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;--right-left&quot;</span><span class="p">,</span>
      <span class="s">&quot;Train right-to-left model&quot;</span><span class="p">);</span>
  <span class="n">cli</span><span class="p">.</span><span class="n">add</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;&gt;</span><span class="p">(</span><span class="s">&quot;--input-types&quot;</span><span class="p">,</span>
      <span class="s">&quot;Provide type of input data if different than &#39;sequence&#39;. &quot;</span>
      <span class="s">&quot;Possible values: sequence, class, alignment, weight. &quot;</span>
      <span class="s">&quot;You need to provide one type per input file (if --train-sets) or per TSV field (if --tsv).&quot;</span><span class="p">,</span>
      <span class="p">{});</span>
  <span class="n">cli</span><span class="p">.</span><span class="n">add</span><span class="o">&lt;</span><span class="kt">bool</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;--best-deep&quot;</span><span class="p">,</span>
      <span class="s">&quot;Use Edinburgh deep RNN configuration (s2s)&quot;</span><span class="p">);</span>
  <span class="n">cli</span><span class="p">.</span><span class="n">add</span><span class="o">&lt;</span><span class="kt">bool</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;--tied-embeddings&quot;</span><span class="p">,</span>
      <span class="s">&quot;Tie target embeddings and output embeddings in output layer&quot;</span><span class="p">);</span>
  <span class="n">cli</span><span class="p">.</span><span class="n">add</span><span class="o">&lt;</span><span class="kt">bool</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;--tied-embeddings-src&quot;</span><span class="p">,</span>
      <span class="s">&quot;Tie source and target embeddings&quot;</span><span class="p">);</span>
  <span class="n">cli</span><span class="p">.</span><span class="n">add</span><span class="o">&lt;</span><span class="kt">bool</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;--tied-embeddings-all&quot;</span><span class="p">,</span>
      <span class="s">&quot;Tie all embedding layers and output layer&quot;</span><span class="p">);</span>
  <span class="n">cli</span><span class="p">.</span><span class="n">add</span><span class="o">&lt;</span><span class="kt">bool</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;--output-omit-bias&quot;</span><span class="p">,</span>
      <span class="s">&quot;Do not use a bias vector in decoder output layer&quot;</span><span class="p">);</span>

  <span class="c1">// Transformer options</span>
  <span class="n">cli</span><span class="p">.</span><span class="n">add</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;--transformer-heads&quot;</span><span class="p">,</span>
      <span class="s">&quot;Number of heads in multi-head attention (transformer)&quot;</span><span class="p">,</span>
      <span class="mi">8</span><span class="p">);</span>
  <span class="n">cli</span><span class="p">.</span><span class="n">add</span><span class="o">&lt;</span><span class="kt">bool</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;--transformer-no-projection&quot;</span><span class="p">,</span>
      <span class="s">&quot;Omit linear projection after multi-head attention (transformer)&quot;</span><span class="p">);</span>
  <span class="n">cli</span><span class="p">.</span><span class="n">add</span><span class="o">&lt;</span><span class="kt">bool</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;--transformer-pool&quot;</span><span class="p">,</span>
      <span class="s">&quot;Pool encoder states instead of using cross attention (selects first encoder state, best used with special token)&quot;</span><span class="p">);</span>
  <span class="n">cli</span><span class="p">.</span><span class="n">add</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;--transformer-dim-ffn&quot;</span><span class="p">,</span>
      <span class="s">&quot;Size of position-wise feed-forward network (transformer)&quot;</span><span class="p">,</span>
      <span class="mi">2048</span><span class="p">);</span>
  <span class="n">cli</span><span class="p">.</span><span class="n">add</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;--transformer-ffn-depth&quot;</span><span class="p">,</span>
      <span class="s">&quot;Depth of filters (transformer)&quot;</span><span class="p">,</span>
      <span class="mi">2</span><span class="p">);</span>
  <span class="n">cli</span><span class="p">.</span><span class="n">add</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;--transformer-ffn-activation&quot;</span><span class="p">,</span>
      <span class="s">&quot;Activation between filters: swish or relu (transformer)&quot;</span><span class="p">,</span>
      <span class="s">&quot;swish&quot;</span><span class="p">);</span>
  <span class="n">cli</span><span class="p">.</span><span class="n">add</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;--transformer-dim-aan&quot;</span><span class="p">,</span>
      <span class="s">&quot;Size of position-wise feed-forward network in AAN (transformer)&quot;</span><span class="p">,</span>
      <span class="mi">2048</span><span class="p">);</span>
  <span class="n">cli</span><span class="p">.</span><span class="n">add</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;--transformer-aan-depth&quot;</span><span class="p">,</span>
      <span class="s">&quot;Depth of filter for AAN (transformer)&quot;</span><span class="p">,</span>
      <span class="mi">2</span><span class="p">);</span>
  <span class="n">cli</span><span class="p">.</span><span class="n">add</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;--transformer-aan-activation&quot;</span><span class="p">,</span>
      <span class="s">&quot;Activation between filters in AAN: swish or relu (transformer)&quot;</span><span class="p">,</span>
      <span class="s">&quot;swish&quot;</span><span class="p">);</span>
  <span class="n">cli</span><span class="p">.</span><span class="n">add</span><span class="o">&lt;</span><span class="kt">bool</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;--transformer-aan-nogate&quot;</span><span class="p">,</span>
      <span class="s">&quot;Omit gate in AAN (transformer)&quot;</span><span class="p">);</span>
  <span class="n">cli</span><span class="p">.</span><span class="n">add</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;--transformer-decoder-autoreg&quot;</span><span class="p">,</span>
      <span class="s">&quot;Type of autoregressive layer in transformer decoder: self-attention, average-attention (transformer)&quot;</span><span class="p">,</span>
      <span class="s">&quot;self-attention&quot;</span><span class="p">);</span>
  <span class="n">cli</span><span class="p">.</span><span class="n">add</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">size_t</span><span class="o">&gt;&gt;</span><span class="p">(</span><span class="s">&quot;--transformer-tied-layers&quot;</span><span class="p">,</span>
      <span class="s">&quot;List of tied decoder layers (transformer)&quot;</span><span class="p">);</span>
  <span class="n">cli</span><span class="p">.</span><span class="n">add</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;--transformer-guided-alignment-layer&quot;</span><span class="p">,</span>
      <span class="s">&quot;Last or number of layer to use for guided alignment training in transformer&quot;</span><span class="p">,</span>
      <span class="s">&quot;last&quot;</span><span class="p">);</span>
  <span class="n">cli</span><span class="p">.</span><span class="n">add</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;--transformer-preprocess&quot;</span><span class="p">,</span>
      <span class="s">&quot;Operation before each transformer layer: d = dropout, a = add, n = normalize&quot;</span><span class="p">);</span>
  <span class="n">cli</span><span class="p">.</span><span class="n">add</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;--transformer-postprocess-emb&quot;</span><span class="p">,</span>
      <span class="s">&quot;Operation after transformer embedding layer: d = dropout, a = add, n = normalize&quot;</span><span class="p">,</span>
      <span class="s">&quot;d&quot;</span><span class="p">);</span>
  <span class="n">cli</span><span class="p">.</span><span class="n">add</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;--transformer-postprocess&quot;</span><span class="p">,</span>
      <span class="s">&quot;Operation after each transformer layer: d = dropout, a = add, n = normalize&quot;</span><span class="p">,</span>
      <span class="s">&quot;dan&quot;</span><span class="p">);</span>
  <span class="n">cli</span><span class="p">.</span><span class="n">add</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;--transformer-postprocess-top&quot;</span><span class="p">,</span>
      <span class="s">&quot;Final operation after a full transformer stack: d = dropout, a = add, n = normalize. The optional skip connection with &#39;a&#39; by-passes the entire stack.&quot;</span><span class="p">,</span>
      <span class="s">&quot;&quot;</span><span class="p">);</span>
  <span class="n">cli</span><span class="p">.</span><span class="n">add</span><span class="o">&lt;</span><span class="kt">bool</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;--transformer-train-position-embeddings&quot;</span><span class="p">,</span>
      <span class="s">&quot;Train positional embeddings instead of using static sinusoidal embeddings&quot;</span><span class="p">);</span>
  <span class="n">cli</span><span class="p">.</span><span class="n">add</span><span class="o">&lt;</span><span class="kt">bool</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;--transformer-depth-scaling&quot;</span><span class="p">,</span>
      <span class="s">&quot;Scale down weight initialization in transformer layers by 1 / sqrt(depth)&quot;</span><span class="p">);</span>

  <span class="n">cli</span><span class="p">.</span><span class="n">add</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;--bert-mask-symbol&quot;</span><span class="p">,</span> <span class="s">&quot;Masking symbol for BERT masked-LM training&quot;</span><span class="p">,</span> <span class="s">&quot;[MASK]&quot;</span><span class="p">);</span>
  <span class="n">cli</span><span class="p">.</span><span class="n">add</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;--bert-sep-symbol&quot;</span><span class="p">,</span> <span class="s">&quot;Sentence separator symbol for BERT next sentence prediction training&quot;</span><span class="p">,</span> <span class="s">&quot;[SEP]&quot;</span><span class="p">);</span>
  <span class="n">cli</span><span class="p">.</span><span class="n">add</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;--bert-class-symbol&quot;</span><span class="p">,</span> <span class="s">&quot;Class symbol BERT classifier training&quot;</span><span class="p">,</span> <span class="s">&quot;[CLS]&quot;</span><span class="p">);</span>
  <span class="n">cli</span><span class="p">.</span><span class="n">add</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;--bert-masking-fraction&quot;</span><span class="p">,</span> <span class="s">&quot;Fraction of masked out tokens during training&quot;</span><span class="p">,</span> <span class="mf">0.15f</span><span class="p">);</span>
  <span class="n">cli</span><span class="p">.</span><span class="n">add</span><span class="o">&lt;</span><span class="kt">bool</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;--bert-train-type-embeddings&quot;</span><span class="p">,</span> <span class="s">&quot;Train bert type embeddings, set to false to use static sinusoidal embeddings&quot;</span><span class="p">,</span> <span class="nb">true</span><span class="p">);</span>
  <span class="n">cli</span><span class="p">.</span><span class="n">add</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;--bert-type-vocab-size&quot;</span><span class="p">,</span> <span class="s">&quot;Size of BERT type vocab (sentence A and B)&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
<span class="cp">#ifdef CUDNN</span>
  <span class="n">cli</span><span class="p">.</span><span class="n">add</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;--char-stride&quot;</span><span class="p">,</span>
      <span class="s">&quot;Width of max-pooling layer after convolution layer in char-s2s model&quot;</span><span class="p">,</span>
      <span class="mi">5</span><span class="p">);</span>
  <span class="n">cli</span><span class="p">.</span><span class="n">add</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;--char-highway&quot;</span><span class="p">,</span>
      <span class="s">&quot;Number of highway network layers after max-pooling in char-s2s model&quot;</span><span class="p">,</span>
      <span class="mi">4</span><span class="p">);</span>
  <span class="n">cli</span><span class="p">.</span><span class="n">add</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;&gt;</span><span class="p">(</span><span class="s">&quot;--char-conv-filters-num&quot;</span><span class="p">,</span>
      <span class="s">&quot;Numbers of convolution filters of corresponding width in char-s2s model&quot;</span><span class="p">,</span>
      <span class="p">{</span><span class="mi">200</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">250</span><span class="p">,</span> <span class="mi">250</span><span class="p">,</span> <span class="mi">300</span><span class="p">,</span> <span class="mi">300</span><span class="p">,</span> <span class="mi">300</span><span class="p">,</span> <span class="mi">300</span><span class="p">});</span>
  <span class="n">cli</span><span class="p">.</span><span class="n">add</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;&gt;</span><span class="p">(</span><span class="s">&quot;--char-conv-filters-widths&quot;</span><span class="p">,</span>
      <span class="s">&quot;Convolution window widths in char-s2s model&quot;</span><span class="p">,</span>
      <span class="p">{</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">});</span>
<span class="cp">#endif</span>

  <span class="k">if</span><span class="p">(</span><span class="n">mode_</span> <span class="o">==</span> <span class="n">cli</span><span class="o">::</span><span class="n">mode</span><span class="o">::</span><span class="n">training</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// TODO: add -&gt;range(0,1);</span>
    <span class="n">cli</span><span class="p">.</span><span class="n">add</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;--dropout-rnn&quot;</span><span class="p">,</span>
        <span class="s">&quot;Scaling dropout along rnn layers and time (0 = no dropout)&quot;</span><span class="p">);</span>
    <span class="n">cli</span><span class="p">.</span><span class="n">add</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;--dropout-src&quot;</span><span class="p">,</span>
        <span class="s">&quot;Dropout source words (0 = no dropout)&quot;</span><span class="p">);</span>
    <span class="n">cli</span><span class="p">.</span><span class="n">add</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;--dropout-trg&quot;</span><span class="p">,</span>
        <span class="s">&quot;Dropout target words (0 = no dropout)&quot;</span><span class="p">);</span>
    <span class="n">cli</span><span class="p">.</span><span class="n">add</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;--grad-dropping-rate&quot;</span><span class="p">,</span>
        <span class="s">&quot;Gradient Dropping rate (0 = no gradient Dropping)&quot;</span><span class="p">);</span>
    <span class="n">cli</span><span class="p">.</span><span class="n">add</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;--grad-dropping-momentum&quot;</span><span class="p">,</span>
        <span class="s">&quot;Gradient Dropping momentum decay rate (0.0 to 1.0)&quot;</span><span class="p">);</span>
    <span class="n">cli</span><span class="p">.</span><span class="n">add</span><span class="o">&lt;</span><span class="kt">size_t</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;--grad-dropping-warmup&quot;</span><span class="p">,</span>
        <span class="s">&quot;Do not apply gradient dropping for the first arg steps&quot;</span><span class="p">,</span>
        <span class="mi">100</span><span class="p">);</span>
    <span class="n">cli</span><span class="p">.</span><span class="n">add</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;--transformer-dropout&quot;</span><span class="p">,</span>
        <span class="s">&quot;Dropout between transformer layers (0 = no dropout)&quot;</span><span class="p">);</span>
    <span class="n">cli</span><span class="p">.</span><span class="n">add</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;--transformer-dropout-attention&quot;</span><span class="p">,</span>
        <span class="s">&quot;Dropout for transformer attention (0 = no dropout)&quot;</span><span class="p">);</span>
    <span class="n">cli</span><span class="p">.</span><span class="n">add</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;--transformer-dropout-ffn&quot;</span><span class="p">,</span>
        <span class="s">&quot;Dropout for transformer filter (0 = no dropout)&quot;</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="n">cli</span><span class="p">.</span><span class="n">switchGroup</span><span class="p">(</span><span class="n">previous_group</span><span class="p">);</span>
  <span class="c1">// clang-format on</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">ConfigParser</span><span class="o">::</span><span class="n">addOptionsTraining</span><span class="p">(</span><span class="n">cli</span><span class="o">::</span><span class="n">CLIWrapper</span><span class="o">&amp;</span> <span class="n">cli</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">auto</span> <span class="n">previous_group</span> <span class="o">=</span> <span class="n">cli</span><span class="p">.</span><span class="n">switchGroup</span><span class="p">(</span><span class="s">&quot;Training options&quot;</span><span class="p">);</span>
  <span class="c1">// clang-format off</span>
  <span class="n">cli</span><span class="p">.</span><span class="n">add</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;--cost-type&quot;</span><span class="p">,</span> <span class="c1">// @TODO: rename to loss-type</span>
      <span class="s">&quot;Optimization criterion: ce-mean, ce-mean-words, ce-sum, perplexity&quot;</span><span class="p">,</span> <span class="s">&quot;ce-sum&quot;</span><span class="p">);</span>
  <span class="n">cli</span><span class="p">.</span><span class="n">add</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;--multi-loss-type&quot;</span><span class="p">,</span>
      <span class="s">&quot;How to accumulate multi-objective losses: sum, scaled, mean&quot;</span><span class="p">,</span> <span class="s">&quot;sum&quot;</span><span class="p">);</span>
  <span class="n">cli</span><span class="p">.</span><span class="n">add</span><span class="o">&lt;</span><span class="kt">bool</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;--unlikelihood-loss&quot;</span><span class="p">,</span>
      <span class="s">&quot;Use word-level weights as indicators for sequence-level unlikelihood training&quot;</span><span class="p">);</span>
  <span class="n">cli</span><span class="p">.</span><span class="n">add</span><span class="o">&lt;</span><span class="kt">bool</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;--overwrite&quot;</span><span class="p">,</span>
      <span class="s">&quot;Do not create model checkpoints, only overwrite main model file with last checkpoint. &quot;</span>
      <span class="s">&quot;Reduces disk usage&quot;</span><span class="p">);</span>
  <span class="n">cli</span><span class="p">.</span><span class="n">add</span><span class="o">&lt;</span><span class="kt">bool</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;--no-reload&quot;</span><span class="p">,</span>
      <span class="s">&quot;Do not load existing model specified in --model arg&quot;</span><span class="p">);</span>
  <span class="n">cli</span><span class="p">.</span><span class="n">add</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;&gt;</span><span class="p">(</span><span class="s">&quot;--train-sets,-t&quot;</span><span class="p">,</span>
      <span class="s">&quot;Paths to training corpora: source target&quot;</span><span class="p">);</span>
  <span class="n">cli</span><span class="p">.</span><span class="n">add</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;&gt;</span><span class="p">(</span><span class="s">&quot;--vocabs,-v&quot;</span><span class="p">,</span>
      <span class="s">&quot;Paths to vocabulary files have to correspond to --train-sets. &quot;</span>
      <span class="s">&quot;If this parameter is not supplied we look for vocabulary files &quot;</span>
      <span class="s">&quot;source.{yml,json} and target.{yml,json}. &quot;</span>
      <span class="s">&quot;If these files do not exist they are created&quot;</span><span class="p">);</span>
<span class="cp">#ifdef USE_SENTENCEPIECE</span>
  <span class="n">cli</span><span class="p">.</span><span class="n">add</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;&gt;</span><span class="p">(</span><span class="s">&quot;--sentencepiece-alphas&quot;</span><span class="p">,</span>
      <span class="s">&quot;Sampling factors for SentencePiece vocabulary; i-th factor corresponds to i-th vocabulary&quot;</span><span class="p">);</span>
  <span class="n">cli</span><span class="p">.</span><span class="n">add</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;--sentencepiece-options&quot;</span><span class="p">,</span>
      <span class="s">&quot;Pass-through command-line options to SentencePiece trainer&quot;</span><span class="p">);</span>
  <span class="n">cli</span><span class="p">.</span><span class="n">add</span><span class="o">&lt;</span><span class="kt">size_t</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;--sentencepiece-max-lines&quot;</span><span class="p">,</span>
      <span class="s">&quot;Maximum lines to train SentencePiece vocabulary, selected with sampling from all data. &quot;</span>
      <span class="s">&quot;When set to 0 all lines are going to be used.&quot;</span><span class="p">,</span>
      <span class="mi">2000000</span><span class="p">);</span>
<span class="cp">#endif</span>
  <span class="c1">// scheduling options</span>

  <span class="c1">// @TODO: these should be re-defined as aliases for `--after` but the current frame work matches on value, so not doable.</span>
  <span class="n">cli</span><span class="p">.</span><span class="n">add</span><span class="o">&lt;</span><span class="kt">size_t</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;--after-epochs,-e&quot;</span><span class="p">,</span>
      <span class="s">&quot;Finish after this many epochs, 0 is infinity (deprecated, &#39;--after-epochs N&#39; corresponds to &#39;--after Ne&#39;)&quot;</span><span class="p">);</span> <span class="c1">// @TODO: replace with alias</span>
  <span class="n">cli</span><span class="p">.</span><span class="n">add</span><span class="o">&lt;</span><span class="kt">size_t</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;--after-batches&quot;</span><span class="p">,</span>
      <span class="s">&quot;Finish after this many batch updates, 0 is infinity (deprecated, &#39;--after-batches N&#39; corresponds to &#39;--after Nu&#39;)&quot;</span><span class="p">);</span> <span class="c1">// @TODO: replace with alias</span>

  <span class="n">cli</span><span class="p">.</span><span class="n">add</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;--after,-a&quot;</span><span class="p">,</span>
      <span class="s">&quot;Finish after this many chosen training units, 0 is infinity (e.g. 100e = 100 epochs, 10Gt = 10 billion target labels, 100Ku = 100,000 updates&quot;</span><span class="p">,</span>
      <span class="s">&quot;0e&quot;</span><span class="p">);</span>
  <span class="n">cli</span><span class="p">.</span><span class="n">add</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="cm">/*SchedulerPeriod*/</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;--disp-freq&quot;</span><span class="p">,</span>
      <span class="s">&quot;Display information every  arg  updates (append &#39;t&#39; for every  arg  target labels)&quot;</span><span class="p">,</span>
      <span class="s">&quot;1000u&quot;</span><span class="p">);</span>
  <span class="n">cli</span><span class="p">.</span><span class="n">add</span><span class="o">&lt;</span><span class="kt">size_t</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;--disp-first&quot;</span><span class="p">,</span>
      <span class="s">&quot;Display information for the first  arg  updates&quot;</span><span class="p">);</span>
  <span class="n">cli</span><span class="p">.</span><span class="n">add</span><span class="o">&lt;</span><span class="kt">bool</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;--disp-label-counts&quot;</span><span class="p">,</span>
      <span class="s">&quot;Display label counts when logging loss progress&quot;</span><span class="p">,</span>
      <span class="nb">true</span><span class="p">);</span>
<span class="c1">//   cli.add&lt;int&gt;(&quot;--disp-label-index&quot;,</span>
<span class="c1">//       &quot;Display label counts based on i-th input stream (-1 is last)&quot;, -1);</span>
  <span class="n">cli</span><span class="p">.</span><span class="n">add</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="cm">/*SchedulerPeriod*/</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;--save-freq&quot;</span><span class="p">,</span>
      <span class="s">&quot;Save model file every  arg  updates (append &#39;t&#39; for every  arg  target labels)&quot;</span><span class="p">,</span>
      <span class="s">&quot;10000u&quot;</span><span class="p">);</span>
  <span class="n">cli</span><span class="p">.</span><span class="n">add</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;&gt;</span><span class="p">(</span><span class="s">&quot;--logical-epoch&quot;</span><span class="p">,</span>
      <span class="s">&quot;Redefine logical epoch counter as multiple of data epochs (e.g. 1e), updates (e.g. 100Ku) or labels (e.g. 1Gt). &quot;</span>
      <span class="s">&quot;Second parameter defines width of fractional display, 0 by default.&quot;</span><span class="p">,</span>
      <span class="p">{</span><span class="s">&quot;1e&quot;</span><span class="p">,</span> <span class="s">&quot;0&quot;</span><span class="p">});</span>

  <span class="n">addSuboptionsInputLength</span><span class="p">(</span><span class="n">cli</span><span class="p">);</span>
  <span class="n">addSuboptionsTSV</span><span class="p">(</span><span class="n">cli</span><span class="p">);</span>

  <span class="c1">// data management options</span>
  <span class="n">cli</span><span class="p">.</span><span class="n">add</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;--shuffle&quot;</span><span class="p">,</span>
      <span class="s">&quot;How to shuffle input data (data: shuffles data and sorted batches; batches: &quot;</span>
      <span class="s">&quot;data is read in order into batches, but batches are shuffled; none: no shuffling). &quot;</span>
      <span class="s">&quot;Use with &#39;--maxi-batch-sort none&#39; in order to achieve exact reading order&quot;</span><span class="p">,</span> <span class="s">&quot;data&quot;</span><span class="p">);</span>
  <span class="n">cli</span><span class="p">.</span><span class="n">add</span><span class="o">&lt;</span><span class="kt">bool</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;--no-shuffle&quot;</span><span class="p">,</span>
      <span class="s">&quot;Shortcut for backwards compatiblity, equivalent to --shuffle none (deprecated)&quot;</span><span class="p">);</span>
  <span class="n">cli</span><span class="p">.</span><span class="n">add</span><span class="o">&lt;</span><span class="kt">bool</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;--no-restore-corpus&quot;</span><span class="p">,</span>
      <span class="s">&quot;Skip restoring corpus state after training is restarted&quot;</span><span class="p">);</span>
  <span class="n">cli</span><span class="p">.</span><span class="n">add</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;--tempdir,-T&quot;</span><span class="p">,</span>
      <span class="s">&quot;Directory for temporary (shuffled) files and database&quot;</span><span class="p">,</span>
      <span class="s">&quot;/tmp&quot;</span><span class="p">);</span>
  <span class="n">cli</span><span class="p">.</span><span class="n">add</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;--sqlite&quot;</span><span class="p">,</span>
      <span class="s">&quot;Use disk-based sqlite3 database for training corpus storage, default&quot;</span>
      <span class="s">&quot; is temporary with path creates persistent storage&quot;</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="n">implicit_val</span><span class="p">(</span><span class="s">&quot;temporary&quot;</span><span class="p">);</span>
  <span class="n">cli</span><span class="p">.</span><span class="n">add</span><span class="o">&lt;</span><span class="kt">bool</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;--sqlite-drop&quot;</span><span class="p">,</span>
      <span class="s">&quot;Drop existing tables in sqlite3 database&quot;</span><span class="p">);</span>

  <span class="n">addSuboptionsDevices</span><span class="p">(</span><span class="n">cli</span><span class="p">);</span>
  <span class="n">addSuboptionsBatching</span><span class="p">(</span><span class="n">cli</span><span class="p">);</span>

  <span class="c1">// optimizer options</span>
  <span class="n">cli</span><span class="p">.</span><span class="n">add</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;--optimizer,-o&quot;</span><span class="p">,</span>
     <span class="s">&quot;Optimization algorithm: sgd, adagrad, adam&quot;</span><span class="p">,</span>
     <span class="s">&quot;adam&quot;</span><span class="p">);</span>
  <span class="n">cli</span><span class="p">.</span><span class="n">add</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;&gt;</span><span class="p">(</span><span class="s">&quot;--optimizer-params&quot;</span><span class="p">,</span>
     <span class="s">&quot;Parameters for optimization algorithm, e.g. betas for Adam. &quot;</span>
     <span class="s">&quot;Auto-adjusted to --mini-batch-words-ref if given&quot;</span><span class="p">);</span>
  <span class="n">cli</span><span class="p">.</span><span class="n">add</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;--optimizer-delay&quot;</span><span class="p">,</span>
     <span class="s">&quot;SGD update delay (#batches between updates). 1 = no delay. &quot;</span>
     <span class="s">&quot;Can be fractional, e.g. 0.1 to use only 10% of each batch&quot;</span><span class="p">,</span>
     <span class="mf">1.f</span><span class="p">);</span>

  <span class="n">cli</span><span class="p">.</span><span class="n">add</span><span class="o">&lt;</span><span class="kt">bool</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;--sync-sgd&quot;</span><span class="p">,</span>
     <span class="s">&quot;Use synchronous SGD instead of asynchronous for multi-gpu training&quot;</span><span class="p">);</span>

  <span class="c1">// learning rate options</span>
  <span class="n">cli</span><span class="p">.</span><span class="n">add</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;--learn-rate,-l&quot;</span><span class="p">,</span>
     <span class="s">&quot;Learning rate. &quot;</span>
      <span class="s">&quot;Auto-adjusted to --mini-batch-words-ref if given&quot;</span><span class="p">,</span>
     <span class="mf">0.0001f</span><span class="p">);</span>
  <span class="n">cli</span><span class="p">.</span><span class="n">add</span><span class="o">&lt;</span><span class="kt">bool</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;--lr-report&quot;</span><span class="p">,</span>
     <span class="s">&quot;Report learning rate for each update&quot;</span><span class="p">);</span>

  <span class="n">cli</span><span class="p">.</span><span class="n">add</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;--lr-decay&quot;</span><span class="p">,</span>
     <span class="s">&quot;Per-update decay factor for learning rate: lr &lt;- lr * arg (0 to disable)&quot;</span><span class="p">);</span>
  <span class="n">cli</span><span class="p">.</span><span class="n">add</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;--lr-decay-strategy&quot;</span><span class="p">,</span>
     <span class="s">&quot;Strategy for learning rate decaying: epoch, batches, stalled, epoch+batches, epoch+stalled&quot;</span><span class="p">,</span>
     <span class="s">&quot;epoch+stalled&quot;</span><span class="p">);</span>
  <span class="n">cli</span><span class="p">.</span><span class="n">add</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">size_t</span><span class="o">&gt;&gt;</span><span class="p">(</span><span class="s">&quot;--lr-decay-start&quot;</span><span class="p">,</span>
     <span class="s">&quot;The first number of (epoch, batches, stalled) validations to start learning rate decaying (tuple)&quot;</span><span class="p">,</span>
     <span class="p">{</span><span class="mi">10</span><span class="p">,</span> <span class="mi">1</span><span class="p">});</span>
  <span class="n">cli</span><span class="p">.</span><span class="n">add</span><span class="o">&lt;</span><span class="kt">size_t</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;--lr-decay-freq&quot;</span><span class="p">,</span>
     <span class="s">&quot;Learning rate decaying frequency for batches, requires --lr-decay-strategy to be batches&quot;</span><span class="p">,</span>
     <span class="mi">50000</span><span class="p">);</span>
  <span class="n">cli</span><span class="p">.</span><span class="n">add</span><span class="o">&lt;</span><span class="kt">bool</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;--lr-decay-reset-optimizer&quot;</span><span class="p">,</span>
      <span class="s">&quot;Reset running statistics of optimizer whenever learning rate decays&quot;</span><span class="p">);</span>
  <span class="n">cli</span><span class="p">.</span><span class="n">add</span><span class="o">&lt;</span><span class="kt">bool</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;--lr-decay-repeat-warmup&quot;</span><span class="p">,</span>
     <span class="s">&quot;Repeat learning rate warmup when learning rate is decayed&quot;</span><span class="p">);</span>
  <span class="n">cli</span><span class="p">.</span><span class="n">add</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="cm">/*SchedulerPeriod*/</span><span class="o">&gt;&gt;</span><span class="p">(</span><span class="s">&quot;--lr-decay-inv-sqrt&quot;</span><span class="p">,</span>
     <span class="s">&quot;Decrease learning rate at arg / sqrt(no. batches) starting at arg  (append &#39;t&#39; or &#39;e&#39; for sqrt(target labels or epochs)). &quot;</span>
     <span class="s">&quot;Add second argument to define the starting point (default: same as first value)&quot;</span><span class="p">,</span>
     <span class="p">{</span><span class="s">&quot;0&quot;</span><span class="p">});</span>

  <span class="n">cli</span><span class="p">.</span><span class="n">add</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="cm">/*SchedulerPeriod*/</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;--lr-warmup&quot;</span><span class="p">,</span>
     <span class="s">&quot;Increase learning rate linearly for  arg  first batches (append &#39;t&#39; for  arg  first target labels)&quot;</span><span class="p">,</span>
      <span class="s">&quot;0&quot;</span><span class="p">);</span>
  <span class="n">cli</span><span class="p">.</span><span class="n">add</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;--lr-warmup-start-rate&quot;</span><span class="p">,</span>
     <span class="s">&quot;Start value for learning rate warmup&quot;</span><span class="p">);</span>
  <span class="n">cli</span><span class="p">.</span><span class="n">add</span><span class="o">&lt;</span><span class="kt">bool</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;--lr-warmup-cycle&quot;</span><span class="p">,</span>
     <span class="s">&quot;Apply cyclic warmup&quot;</span><span class="p">);</span>
  <span class="n">cli</span><span class="p">.</span><span class="n">add</span><span class="o">&lt;</span><span class="kt">bool</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;--lr-warmup-at-reload&quot;</span><span class="p">,</span>
     <span class="s">&quot;Repeat warmup after interrupted training&quot;</span><span class="p">);</span>

  <span class="n">cli</span><span class="p">.</span><span class="n">add</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;--label-smoothing&quot;</span><span class="p">,</span>
     <span class="s">&quot;Epsilon for label smoothing (0 to disable)&quot;</span><span class="p">);</span>
  <span class="n">cli</span><span class="p">.</span><span class="n">add</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;--factor-weight&quot;</span><span class="p">,</span>
     <span class="s">&quot;Weight for loss function for factors (factored vocab only) (1 to disable)&quot;</span><span class="p">,</span> <span class="mf">1.0f</span><span class="p">);</span>
  <span class="n">cli</span><span class="p">.</span><span class="n">add</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;--clip-norm&quot;</span><span class="p">,</span>
     <span class="s">&quot;Clip gradient norm to  arg  (0 to disable)&quot;</span><span class="p">,</span>
     <span class="mf">1.f</span><span class="p">);</span> <span class="c1">// @TODO: this is currently wrong with ce-sum and should rather be disabled or fixed by multiplying with labels</span>
  <span class="n">cli</span><span class="p">.</span><span class="n">add</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;--exponential-smoothing&quot;</span><span class="p">,</span>
     <span class="s">&quot;Maintain smoothed version of parameters for validation and saving with smoothing factor. 0 to disable. &quot;</span>
      <span class="s">&quot;Auto-adjusted to --mini-batch-words-ref if given.&quot;</span><span class="p">,</span>
     <span class="mf">0.f</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">implicit_val</span><span class="p">(</span><span class="s">&quot;1e-4&quot;</span><span class="p">);</span>
  <span class="n">cli</span><span class="p">.</span><span class="n">add</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;--guided-alignment&quot;</span><span class="p">,</span>
     <span class="s">&quot;Path to a file with word alignments. Use guided alignment to guide attention or &#39;none&#39;. &quot;</span>
     <span class="s">&quot;If --tsv it specifies the index of a TSV field that contains the alignments (0-based)&quot;</span><span class="p">,</span>
     <span class="s">&quot;none&quot;</span><span class="p">);</span>
  <span class="n">cli</span><span class="p">.</span><span class="n">add</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;--guided-alignment-cost&quot;</span><span class="p">,</span>
     <span class="s">&quot;Cost type for guided alignment: ce (cross-entropy), mse (mean square error), mult (multiplication)&quot;</span><span class="p">,</span>
     <span class="s">&quot;mse&quot;</span><span class="p">);</span>
  <span class="n">cli</span><span class="p">.</span><span class="n">add</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;--guided-alignment-weight&quot;</span><span class="p">,</span>
     <span class="s">&quot;Weight for guided alignment cost&quot;</span><span class="p">,</span>
     <span class="mf">0.1</span><span class="p">);</span>
  <span class="n">cli</span><span class="p">.</span><span class="n">add</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;--data-weighting&quot;</span><span class="p">,</span>
     <span class="s">&quot;Path to a file with sentence or word weights. &quot;</span>
     <span class="s">&quot;If --tsv it specifies the index of a TSV field that contains the weights (0-based)&quot;</span><span class="p">);</span>
  <span class="n">cli</span><span class="p">.</span><span class="n">add</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;--data-weighting-type&quot;</span><span class="p">,</span>
     <span class="s">&quot;Processing level for data weighting: sentence, word&quot;</span><span class="p">,</span>
     <span class="s">&quot;sentence&quot;</span><span class="p">);</span>

  <span class="c1">// embedding options</span>
  <span class="n">cli</span><span class="p">.</span><span class="n">add</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;&gt;</span><span class="p">(</span><span class="s">&quot;--embedding-vectors&quot;</span><span class="p">,</span>
     <span class="s">&quot;Paths to files with custom source and target embedding vectors&quot;</span><span class="p">);</span>
  <span class="n">cli</span><span class="p">.</span><span class="n">add</span><span class="o">&lt;</span><span class="kt">bool</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;--embedding-normalization&quot;</span><span class="p">,</span>
     <span class="s">&quot;Normalize values from custom embedding vectors to [-1, 1]&quot;</span><span class="p">);</span>
  <span class="n">cli</span><span class="p">.</span><span class="n">add</span><span class="o">&lt;</span><span class="kt">bool</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;--embedding-fix-src&quot;</span><span class="p">,</span>
     <span class="s">&quot;Fix source embeddings. Affects all encoders&quot;</span><span class="p">);</span>
  <span class="n">cli</span><span class="p">.</span><span class="n">add</span><span class="o">&lt;</span><span class="kt">bool</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;--embedding-fix-trg&quot;</span><span class="p">,</span>
     <span class="s">&quot;Fix target embeddings. Affects all decoders&quot;</span><span class="p">);</span>

  <span class="c1">// mixed precision training</span>
  <span class="n">cli</span><span class="p">.</span><span class="n">add</span><span class="o">&lt;</span><span class="kt">bool</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;--fp16&quot;</span><span class="p">,</span>
      <span class="s">&quot;Shortcut for mixed precision training with float16 and cost-scaling, &quot;</span>
      <span class="s">&quot;corresponds to: --precision float16 float32 float32 --cost-scaling 7 2000 2 0.05 10 1&quot;</span><span class="p">);</span>
  <span class="n">cli</span><span class="p">.</span><span class="n">add</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;&gt;</span><span class="p">(</span><span class="s">&quot;--precision&quot;</span><span class="p">,</span>
      <span class="s">&quot;Mixed precision training for forward/backward pass and optimizaton. &quot;</span>
      <span class="s">&quot;Defines types for: forward/backward, optimization, saving.&quot;</span><span class="p">,</span>
      <span class="p">{</span><span class="s">&quot;float32&quot;</span><span class="p">,</span> <span class="s">&quot;float32&quot;</span><span class="p">,</span> <span class="s">&quot;float32&quot;</span><span class="p">});</span>
  <span class="n">cli</span><span class="p">.</span><span class="n">add</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;&gt;</span><span class="p">(</span><span class="s">&quot;--cost-scaling&quot;</span><span class="p">,</span>
      <span class="s">&quot;Dynamic cost scaling for mixed precision training: &quot;</span>
      <span class="s">&quot;power of 2, scaling window, scaling factor, tolerance, range, minimum factor&quot;</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="n">implicit_val</span><span class="p">(</span><span class="s">&quot;7.f 2000 2.f 0.05f 10 1.f&quot;</span><span class="p">);</span>
  <span class="n">cli</span><span class="p">.</span><span class="n">add</span><span class="o">&lt;</span><span class="kt">bool</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;--normalize-gradient&quot;</span><span class="p">,</span>
      <span class="s">&quot;Normalize gradient by multiplying with no. devices / total labels&quot;</span><span class="p">);</span>

  <span class="n">cli</span><span class="p">.</span><span class="n">add</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;&gt;</span><span class="p">(</span><span class="s">&quot;--train-embedder-rank&quot;</span><span class="p">,</span>
      <span class="s">&quot;Override model configuration and train a embedding similarity ranker with the model encoder, &quot;</span>
      <span class="s">&quot;parameters encode margin and an optional normalization factor&quot;</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="n">implicit_val</span><span class="p">(</span><span class="s">&quot;0.3f 0.0f&quot;</span><span class="p">);</span>

  <span class="c1">// multi-node training</span>
  <span class="n">cli</span><span class="p">.</span><span class="n">add</span><span class="o">&lt;</span><span class="kt">bool</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;--multi-node&quot;</span><span class="p">,</span>
     <span class="s">&quot;Enable asynchronous multi-node training through MPI (and legacy sync if combined with --sync-sgd)&quot;</span><span class="p">);</span>
  <span class="n">cli</span><span class="p">.</span><span class="n">add</span><span class="o">&lt;</span><span class="kt">bool</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;--multi-node-overlap&quot;</span><span class="p">,</span>
     <span class="s">&quot;Overlap model computations with MPI communication&quot;</span><span class="p">,</span>
     <span class="nb">true</span><span class="p">);</span>

  <span class="c1">// model quantization training</span>
  <span class="n">addSuboptionsQuantization</span><span class="p">(</span><span class="n">cli</span><span class="p">);</span>

  <span class="c1">// add ULR settings</span>
  <span class="n">addSuboptionsULR</span><span class="p">(</span><span class="n">cli</span><span class="p">);</span>

  <span class="n">cli</span><span class="p">.</span><span class="n">add</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;&gt;</span><span class="p">(</span><span class="s">&quot;--task&quot;</span><span class="p">,</span>
     <span class="s">&quot;Use predefined set of options. Possible values: transformer, transformer-big&quot;</span><span class="p">);</span>
  <span class="n">cli</span><span class="p">.</span><span class="n">switchGroup</span><span class="p">(</span><span class="n">previous_group</span><span class="p">);</span>
  <span class="c1">// clang-format on</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">ConfigParser</span><span class="o">::</span><span class="n">addOptionsValidation</span><span class="p">(</span><span class="n">cli</span><span class="o">::</span><span class="n">CLIWrapper</span><span class="o">&amp;</span> <span class="n">cli</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">auto</span> <span class="n">previous_group</span> <span class="o">=</span> <span class="n">cli</span><span class="p">.</span><span class="n">switchGroup</span><span class="p">(</span><span class="s">&quot;Validation set options&quot;</span><span class="p">);</span>

  <span class="c1">// clang-format off</span>
  <span class="n">cli</span><span class="p">.</span><span class="n">add</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;&gt;</span><span class="p">(</span><span class="s">&quot;--valid-sets&quot;</span><span class="p">,</span>
      <span class="s">&quot;Paths to validation corpora: source target&quot;</span><span class="p">);</span>
  <span class="n">cli</span><span class="p">.</span><span class="n">add</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="cm">/*SchedulerPeriod*/</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;--valid-freq&quot;</span><span class="p">,</span>
      <span class="s">&quot;Validate model every  arg  updates (append &#39;t&#39; for every  arg  target labels)&quot;</span><span class="p">,</span>
      <span class="s">&quot;10000u&quot;</span><span class="p">);</span>
  <span class="n">cli</span><span class="p">.</span><span class="n">add</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;&gt;</span><span class="p">(</span><span class="s">&quot;--valid-metrics&quot;</span><span class="p">,</span>
      <span class="s">&quot;Metric to use during validation: cross-entropy, ce-mean-words, perplexity, valid-script, &quot;</span>
      <span class="s">&quot;translation, bleu, bleu-detok (deprecated, same as bleu), bleu-segmented, chrf. &quot;</span>
      <span class="s">&quot;Multiple metrics can be specified&quot;</span><span class="p">,</span>
      <span class="p">{</span><span class="s">&quot;cross-entropy&quot;</span><span class="p">});</span>
  <span class="n">cli</span><span class="p">.</span><span class="n">add</span><span class="o">&lt;</span><span class="kt">bool</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;--valid-reset-stalled&quot;</span><span class="p">,</span>
     <span class="s">&quot;Reset all stalled validation metrics when the training is restarted&quot;</span><span class="p">);</span>
  <span class="n">cli</span><span class="p">.</span><span class="n">add</span><span class="o">&lt;</span><span class="kt">size_t</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;--early-stopping&quot;</span><span class="p">,</span>
     <span class="s">&quot;Stop if the first validation metric does not improve for  arg  consecutive validation steps&quot;</span><span class="p">,</span>
     <span class="mi">10</span><span class="p">);</span>

  <span class="c1">// decoding options</span>
  <span class="n">cli</span><span class="p">.</span><span class="n">add</span><span class="o">&lt;</span><span class="kt">size_t</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;--beam-size,-b&quot;</span><span class="p">,</span>
      <span class="s">&quot;Beam size used during search with validating translator&quot;</span><span class="p">,</span>
      <span class="mi">12</span><span class="p">);</span>
  <span class="n">cli</span><span class="p">.</span><span class="n">add</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;--normalize,-n&quot;</span><span class="p">,</span>
      <span class="s">&quot;Divide translation score by pow(translation length, arg)&quot;</span><span class="p">,</span>
      <span class="mi">0</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">implicit_val</span><span class="p">(</span><span class="s">&quot;1&quot;</span><span class="p">);</span>
  <span class="n">cli</span><span class="p">.</span><span class="n">add</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;--max-length-factor&quot;</span><span class="p">,</span>
      <span class="s">&quot;Maximum target length as source length times factor&quot;</span><span class="p">,</span>
      <span class="mi">3</span><span class="p">);</span>
  <span class="n">cli</span><span class="p">.</span><span class="n">add</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;--word-penalty&quot;</span><span class="p">,</span>
      <span class="s">&quot;Subtract (arg * translation length) from translation score &quot;</span><span class="p">);</span>
  <span class="n">cli</span><span class="p">.</span><span class="n">add</span><span class="o">&lt;</span><span class="kt">bool</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;--allow-unk&quot;</span><span class="p">,</span>
      <span class="s">&quot;Allow unknown words to appear in output&quot;</span><span class="p">);</span>
  <span class="n">cli</span><span class="p">.</span><span class="n">add</span><span class="o">&lt;</span><span class="kt">bool</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;--n-best&quot;</span><span class="p">,</span>
      <span class="s">&quot;Generate n-best list&quot;</span><span class="p">);</span>
  <span class="n">cli</span><span class="p">.</span><span class="n">add</span><span class="o">&lt;</span><span class="kt">bool</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;--word-scores&quot;</span><span class="p">,</span>
      <span class="s">&quot;Print word-level scores. One score per subword unit, not normalized even if --normalize&quot;</span><span class="p">);</span>

  <span class="c1">// efficiency options</span>
  <span class="n">cli</span><span class="p">.</span><span class="n">add</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;--valid-mini-batch&quot;</span><span class="p">,</span>
      <span class="s">&quot;Size of mini-batch used during validation&quot;</span><span class="p">,</span>
      <span class="mi">32</span><span class="p">);</span>
  <span class="n">cli</span><span class="p">.</span><span class="n">add</span><span class="o">&lt;</span><span class="kt">size_t</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;--valid-max-length&quot;</span><span class="p">,</span>
      <span class="s">&quot;Maximum length of a sentence in a validating sentence pair. &quot;</span>
      <span class="s">&quot;Sentences longer than valid-max-length are cropped to valid-max-length&quot;</span><span class="p">,</span>
      <span class="mi">1000</span><span class="p">);</span>

  <span class="c1">// options for validation script</span>
  <span class="n">cli</span><span class="p">.</span><span class="n">add</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;--valid-script-path&quot;</span><span class="p">,</span>
     <span class="s">&quot;Path to external validation script.&quot;</span>
     <span class="s">&quot; It should print a single score to stdout.&quot;</span>
     <span class="s">&quot; If the option is used with validating translation, the output&quot;</span>
     <span class="s">&quot; translation file will be passed as a first argument&quot;</span><span class="p">);</span>
  <span class="n">cli</span><span class="p">.</span><span class="n">add</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;&gt;</span><span class="p">(</span><span class="s">&quot;--valid-script-args&quot;</span><span class="p">,</span>
      <span class="s">&quot;Additional args passed to --valid-script-path. These are inserted&quot;</span>
      <span class="s">&quot; between the script path and the output translation-file path&quot;</span><span class="p">);</span>
  <span class="n">cli</span><span class="p">.</span><span class="n">add</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;--valid-translation-output&quot;</span><span class="p">,</span>
     <span class="s">&quot;(Template for) path to store the translation. &quot;</span>
     <span class="s">&quot;E.g., validation-output-after-{U}-updates-{T}-tokens.txt. Template &quot;</span>
     <span class="s">&quot;parameters: {E} for epoch; {B} for No. of batches within epoch; &quot;</span>
     <span class="s">&quot;{U} for total No. of updates; {T} for total No. of tokens seen.&quot;</span><span class="p">);</span>
  <span class="n">cli</span><span class="p">.</span><span class="n">add</span><span class="o">&lt;</span><span class="kt">bool</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;--keep-best&quot;</span><span class="p">,</span>
      <span class="s">&quot;Keep best model for each validation metric&quot;</span><span class="p">);</span>
  <span class="n">cli</span><span class="p">.</span><span class="n">add</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;--valid-log&quot;</span><span class="p">,</span>
     <span class="s">&quot;Log validation scores to file given by  arg&quot;</span><span class="p">);</span>
  <span class="n">cli</span><span class="p">.</span><span class="n">switchGroup</span><span class="p">(</span><span class="n">previous_group</span><span class="p">);</span>
  <span class="c1">// clang-format on</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">ConfigParser</span><span class="o">::</span><span class="n">addOptionsTranslation</span><span class="p">(</span><span class="n">cli</span><span class="o">::</span><span class="n">CLIWrapper</span><span class="o">&amp;</span> <span class="n">cli</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">auto</span> <span class="n">previous_group</span> <span class="o">=</span> <span class="n">cli</span><span class="p">.</span><span class="n">switchGroup</span><span class="p">(</span><span class="s">&quot;Translator options&quot;</span><span class="p">);</span>

  <span class="c1">// clang-format off</span>
  <span class="n">cli</span><span class="p">.</span><span class="n">add</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;&gt;</span><span class="p">(</span><span class="s">&quot;--input,-i&quot;</span><span class="p">,</span>
      <span class="s">&quot;Paths to input file(s), stdin by default&quot;</span><span class="p">,</span>
      <span class="p">{</span><span class="s">&quot;stdin&quot;</span><span class="p">});</span>
  <span class="n">cli</span><span class="p">.</span><span class="n">add</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;--output,-o&quot;</span><span class="p">,</span>
      <span class="s">&quot;Path to output file, stdout by default&quot;</span><span class="p">,</span>
      <span class="s">&quot;stdout&quot;</span><span class="p">);</span>
  <span class="n">cli</span><span class="p">.</span><span class="n">add</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;&gt;</span><span class="p">(</span><span class="s">&quot;--vocabs,-v&quot;</span><span class="p">,</span>
      <span class="s">&quot;Paths to vocabulary files have to correspond to --input&quot;</span><span class="p">);</span>
  <span class="c1">// decoding options</span>
  <span class="n">cli</span><span class="p">.</span><span class="n">add</span><span class="o">&lt;</span><span class="kt">size_t</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;--beam-size,-b&quot;</span><span class="p">,</span>
      <span class="s">&quot;Beam size used during search with validating translator&quot;</span><span class="p">,</span>
      <span class="mi">12</span><span class="p">);</span>
  <span class="n">cli</span><span class="p">.</span><span class="n">add</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;--normalize,-n&quot;</span><span class="p">,</span>
      <span class="s">&quot;Divide translation score by pow(translation length, arg)&quot;</span><span class="p">,</span>
      <span class="mi">0</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">implicit_val</span><span class="p">(</span><span class="s">&quot;1&quot;</span><span class="p">);</span>
  <span class="n">cli</span><span class="p">.</span><span class="n">add</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;--max-length-factor&quot;</span><span class="p">,</span>
      <span class="s">&quot;Maximum target length as source length times factor&quot;</span><span class="p">,</span>
      <span class="mi">3</span><span class="p">);</span>
  <span class="n">cli</span><span class="p">.</span><span class="n">add</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;--word-penalty&quot;</span><span class="p">,</span>
      <span class="s">&quot;Subtract (arg * translation length) from translation score&quot;</span><span class="p">);</span>
  <span class="n">cli</span><span class="p">.</span><span class="n">add</span><span class="o">&lt;</span><span class="kt">bool</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;--allow-unk&quot;</span><span class="p">,</span>
      <span class="s">&quot;Allow unknown words to appear in output&quot;</span><span class="p">);</span>
  <span class="n">cli</span><span class="p">.</span><span class="n">add</span><span class="o">&lt;</span><span class="kt">bool</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;--n-best&quot;</span><span class="p">,</span>
      <span class="s">&quot;Generate n-best list&quot;</span><span class="p">);</span>
  <span class="n">cli</span><span class="p">.</span><span class="n">add</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;--alignment&quot;</span><span class="p">,</span>
     <span class="s">&quot;Return word alignment. Possible values: 0.0-1.0, hard, soft&quot;</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="n">implicit_val</span><span class="p">(</span><span class="s">&quot;1&quot;</span><span class="p">);</span>
  <span class="n">cli</span><span class="p">.</span><span class="n">add</span><span class="o">&lt;</span><span class="kt">bool</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;--word-scores&quot;</span><span class="p">,</span>
      <span class="s">&quot;Print word-level scores. One score per subword unit, not normalized even if --normalize&quot;</span><span class="p">);</span>
<span class="cp">#ifdef USE_SENTENCEPIECE</span>
  <span class="n">cli</span><span class="p">.</span><span class="n">add</span><span class="o">&lt;</span><span class="kt">bool</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;--no-spm-decode&quot;</span><span class="p">,</span>
      <span class="s">&quot;Keep the output segmented into SentencePiece subwords&quot;</span><span class="p">);</span>
<span class="cp">#endif</span>

  <span class="n">addSuboptionsInputLength</span><span class="p">(</span><span class="n">cli</span><span class="p">);</span>
  <span class="n">addSuboptionsTSV</span><span class="p">(</span><span class="n">cli</span><span class="p">);</span>
  <span class="n">addSuboptionsDevices</span><span class="p">(</span><span class="n">cli</span><span class="p">);</span>
  <span class="n">addSuboptionsBatching</span><span class="p">(</span><span class="n">cli</span><span class="p">);</span>

  <span class="n">cli</span><span class="p">.</span><span class="n">add</span><span class="o">&lt;</span><span class="kt">bool</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;--fp16&quot;</span><span class="p">,</span>
      <span class="s">&quot;Shortcut for mixed precision inference with float16, corresponds to: --precision float16&quot;</span><span class="p">);</span>
  <span class="n">cli</span><span class="p">.</span><span class="n">add</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;&gt;</span><span class="p">(</span><span class="s">&quot;--precision&quot;</span><span class="p">,</span>
      <span class="s">&quot;Mixed precision for inference, set parameter type in expression graph&quot;</span><span class="p">,</span>
      <span class="p">{</span><span class="s">&quot;float32&quot;</span><span class="p">});</span>
  <span class="n">cli</span><span class="p">.</span><span class="n">add</span><span class="o">&lt;</span><span class="kt">bool</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;--skip-cost&quot;</span><span class="p">,</span>
    <span class="s">&quot;Ignore model cost during translation, not recommended for beam-size &gt; 1&quot;</span><span class="p">);</span>

  <span class="n">cli</span><span class="p">.</span><span class="n">add</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;&gt;</span><span class="p">(</span><span class="s">&quot;--shortlist&quot;</span><span class="p">,</span>
     <span class="s">&quot;Use softmax shortlist: path first best prune&quot;</span><span class="p">);</span>
  <span class="n">cli</span><span class="p">.</span><span class="n">add</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;&gt;</span><span class="p">(</span><span class="s">&quot;--weights&quot;</span><span class="p">,</span>
      <span class="s">&quot;Scorer weights&quot;</span><span class="p">);</span>
  <span class="n">cli</span><span class="p">.</span><span class="n">add</span><span class="o">&lt;</span><span class="kt">bool</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;--output-sampling&quot;</span><span class="p">,</span>
     <span class="s">&quot;Noise output layer with gumbel noise&quot;</span><span class="p">,</span>
      <span class="nb">false</span><span class="p">);</span>
  <span class="n">cli</span><span class="p">.</span><span class="n">add</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;&gt;</span><span class="p">(</span><span class="s">&quot;--output-approx-knn&quot;</span><span class="p">,</span>
     <span class="s">&quot;Use approximate knn search in output layer (currently only in transformer)&quot;</span><span class="p">)</span>
     <span class="o">-&gt;</span><span class="n">implicit_val</span><span class="p">(</span><span class="s">&quot;100 1024&quot;</span><span class="p">);</span>

<span class="cp">#if 0</span><span class="c"> // @TODO: Ask Hany if there are any decoding-time options</span>
<span class="c">  // add ULR settings</span>
<span class="c">  addSuboptionsULR(cli);</span>
<span class="cp">#endif</span>

  <span class="n">cli</span><span class="p">.</span><span class="n">switchGroup</span><span class="p">(</span><span class="n">previous_group</span><span class="p">);</span>
  <span class="c1">// clang-format on</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">ConfigParser</span><span class="o">::</span><span class="n">addOptionsScoring</span><span class="p">(</span><span class="n">cli</span><span class="o">::</span><span class="n">CLIWrapper</span><span class="o">&amp;</span> <span class="n">cli</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">auto</span> <span class="n">previous_group</span> <span class="o">=</span> <span class="n">cli</span><span class="p">.</span><span class="n">switchGroup</span><span class="p">(</span><span class="s">&quot;Scorer options&quot;</span><span class="p">);</span>

  <span class="c1">// clang-format off</span>
  <span class="n">cli</span><span class="p">.</span><span class="n">add</span><span class="o">&lt;</span><span class="kt">bool</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;--no-reload&quot;</span><span class="p">,</span>
      <span class="s">&quot;Do not load existing model specified in --model arg&quot;</span><span class="p">);</span>
  <span class="c1">// TODO: move options like vocabs and train-sets to a separate procedure as they are defined twice</span>
  <span class="n">cli</span><span class="p">.</span><span class="n">add</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;&gt;</span><span class="p">(</span><span class="s">&quot;--train-sets,-t&quot;</span><span class="p">,</span>
      <span class="s">&quot;Paths to corpora to be scored: source target&quot;</span><span class="p">);</span>
  <span class="n">cli</span><span class="p">.</span><span class="n">add</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;--output,-o&quot;</span><span class="p">,</span>
      <span class="s">&quot;Path to output file, stdout by default&quot;</span><span class="p">,</span>
      <span class="s">&quot;stdout&quot;</span><span class="p">);</span>
  <span class="n">cli</span><span class="p">.</span><span class="n">add</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;&gt;</span><span class="p">(</span><span class="s">&quot;--vocabs,-v&quot;</span><span class="p">,</span>
      <span class="s">&quot;Paths to vocabulary files have to correspond to --train-sets. &quot;</span>
      <span class="s">&quot;If this parameter is not supplied we look for vocabulary files source.{yml,json} and target.{yml,json}. &quot;</span>
      <span class="s">&quot;If these files do not exists they are created&quot;</span><span class="p">);</span>
  <span class="n">cli</span><span class="p">.</span><span class="n">add</span><span class="o">&lt;</span><span class="kt">bool</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;--n-best&quot;</span><span class="p">,</span>
      <span class="s">&quot;Score n-best list instead of plain text corpus&quot;</span><span class="p">);</span>
  <span class="n">cli</span><span class="p">.</span><span class="n">add</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;--n-best-feature&quot;</span><span class="p">,</span>
      <span class="s">&quot;Feature name to be inserted into n-best list&quot;</span><span class="p">,</span> <span class="s">&quot;Score&quot;</span><span class="p">);</span>
  <span class="n">cli</span><span class="p">.</span><span class="n">add</span><span class="o">&lt;</span><span class="kt">bool</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;--normalize,-n&quot;</span><span class="p">,</span>
      <span class="s">&quot;Divide translation score by translation length&quot;</span><span class="p">);</span>
  <span class="n">cli</span><span class="p">.</span><span class="n">add</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;--summary&quot;</span><span class="p">,</span>
      <span class="s">&quot;Only print total cost, possible values: cross-entropy (ce-mean), ce-mean-words, ce-sum, perplexity&quot;</span><span class="p">)</span>
      <span class="o">-&gt;</span><span class="n">implicit_val</span><span class="p">(</span><span class="s">&quot;cross-entropy&quot;</span><span class="p">);</span>
  <span class="n">cli</span><span class="p">.</span><span class="n">add</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;--alignment&quot;</span><span class="p">,</span>
     <span class="s">&quot;Return word alignments. Possible values: 0.0-1.0, hard, soft&quot;</span><span class="p">)</span>
     <span class="o">-&gt;</span><span class="n">implicit_val</span><span class="p">(</span><span class="s">&quot;1&quot;</span><span class="p">),</span>
  <span class="n">cli</span><span class="p">.</span><span class="n">add</span><span class="o">&lt;</span><span class="kt">bool</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;--word-scores&quot;</span><span class="p">,</span>
      <span class="s">&quot;Print word-level scores. One score per subword unit, not normalized even if --normalize&quot;</span><span class="p">);</span>

  <span class="n">addSuboptionsInputLength</span><span class="p">(</span><span class="n">cli</span><span class="p">);</span>
  <span class="n">addSuboptionsTSV</span><span class="p">(</span><span class="n">cli</span><span class="p">);</span>
  <span class="n">addSuboptionsDevices</span><span class="p">(</span><span class="n">cli</span><span class="p">);</span>
  <span class="n">addSuboptionsBatching</span><span class="p">(</span><span class="n">cli</span><span class="p">);</span>

  <span class="n">cli</span><span class="p">.</span><span class="n">add</span><span class="o">&lt;</span><span class="kt">bool</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;--fp16&quot;</span><span class="p">,</span>
      <span class="s">&quot;Shortcut for mixed precision inference with float16, corresponds to: --precision float16&quot;</span><span class="p">);</span>
  <span class="n">cli</span><span class="p">.</span><span class="n">add</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;&gt;</span><span class="p">(</span><span class="s">&quot;--precision&quot;</span><span class="p">,</span>
      <span class="s">&quot;Mixed precision for inference, set parameter type in expression graph&quot;</span><span class="p">,</span>
      <span class="p">{</span><span class="s">&quot;float32&quot;</span><span class="p">});</span>

  <span class="n">cli</span><span class="p">.</span><span class="n">switchGroup</span><span class="p">(</span><span class="n">previous_group</span><span class="p">);</span>
  <span class="c1">// clang-format on</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">ConfigParser</span><span class="o">::</span><span class="n">addOptionsEmbedding</span><span class="p">(</span><span class="n">cli</span><span class="o">::</span><span class="n">CLIWrapper</span><span class="o">&amp;</span> <span class="n">cli</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">auto</span> <span class="n">previous_group</span> <span class="o">=</span> <span class="n">cli</span><span class="p">.</span><span class="n">switchGroup</span><span class="p">(</span><span class="s">&quot;Scorer options&quot;</span><span class="p">);</span>

  <span class="c1">// clang-format off</span>
  <span class="n">cli</span><span class="p">.</span><span class="n">add</span><span class="o">&lt;</span><span class="kt">bool</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;--no-reload&quot;</span><span class="p">,</span>
      <span class="s">&quot;Do not load existing model specified in --model arg&quot;</span><span class="p">);</span>
  <span class="c1">// TODO: move options like vocabs and train-sets to a separate procedure as they are defined twice</span>
  <span class="n">cli</span><span class="p">.</span><span class="n">add</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;&gt;</span><span class="p">(</span><span class="s">&quot;--train-sets,-t&quot;</span><span class="p">,</span>
      <span class="s">&quot;Paths to corpora to be scored: source target&quot;</span><span class="p">);</span>
  <span class="n">cli</span><span class="p">.</span><span class="n">add</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;--output,-o&quot;</span><span class="p">,</span>
      <span class="s">&quot;Path to output file, stdout by default&quot;</span><span class="p">,</span>
      <span class="s">&quot;stdout&quot;</span><span class="p">);</span>
  <span class="n">cli</span><span class="p">.</span><span class="n">add</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;&gt;</span><span class="p">(</span><span class="s">&quot;--vocabs,-v&quot;</span><span class="p">,</span>
      <span class="s">&quot;Paths to vocabulary files have to correspond to --train-sets. &quot;</span>
      <span class="s">&quot;If this parameter is not supplied we look for vocabulary files source.{yml,json} and target.{yml,json}. &quot;</span>
      <span class="s">&quot;If these files do not exists they are created&quot;</span><span class="p">);</span>

  <span class="n">cli</span><span class="p">.</span><span class="n">add</span><span class="o">&lt;</span><span class="kt">bool</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;--compute-similarity&quot;</span><span class="p">,</span>
      <span class="s">&quot;Expect two inputs and compute cosine similarity instead of outputting embedding vector&quot;</span><span class="p">);</span>
  <span class="n">cli</span><span class="p">.</span><span class="n">add</span><span class="o">&lt;</span><span class="kt">bool</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;--binary&quot;</span><span class="p">,</span>
      <span class="s">&quot;Output vectors as binary floats&quot;</span><span class="p">);</span>

  <span class="n">addSuboptionsInputLength</span><span class="p">(</span><span class="n">cli</span><span class="p">);</span>
  <span class="n">addSuboptionsTSV</span><span class="p">(</span><span class="n">cli</span><span class="p">);</span>
  <span class="n">addSuboptionsDevices</span><span class="p">(</span><span class="n">cli</span><span class="p">);</span>
  <span class="n">addSuboptionsBatching</span><span class="p">(</span><span class="n">cli</span><span class="p">);</span>

  <span class="n">cli</span><span class="p">.</span><span class="n">add</span><span class="o">&lt;</span><span class="kt">bool</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;--fp16&quot;</span><span class="p">,</span>
      <span class="s">&quot;Shortcut for mixed precision inference with float16, corresponds to: --precision float16&quot;</span><span class="p">);</span>
  <span class="n">cli</span><span class="p">.</span><span class="n">add</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;&gt;</span><span class="p">(</span><span class="s">&quot;--precision&quot;</span><span class="p">,</span>
      <span class="s">&quot;Mixed precision for inference, set parameter type in expression graph. Supported values: float32, float16&quot;</span><span class="p">,</span>
      <span class="p">{</span><span class="s">&quot;float32&quot;</span><span class="p">});</span>

  <span class="n">cli</span><span class="p">.</span><span class="n">switchGroup</span><span class="p">(</span><span class="n">previous_group</span><span class="p">);</span>
  <span class="c1">// clang-format on</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">ConfigParser</span><span class="o">::</span><span class="n">addSuboptionsDevices</span><span class="p">(</span><span class="n">cli</span><span class="o">::</span><span class="n">CLIWrapper</span><span class="o">&amp;</span> <span class="n">cli</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// clang-format off</span>
  <span class="n">cli</span><span class="p">.</span><span class="n">add</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;&gt;</span><span class="p">(</span><span class="s">&quot;--devices,-d&quot;</span><span class="p">,</span>
      <span class="s">&quot;Specifies GPU ID(s) to use for training. Defaults to 0..num-devices-1&quot;</span><span class="p">,</span>
      <span class="p">{</span><span class="s">&quot;0&quot;</span><span class="p">});</span>
  <span class="n">cli</span><span class="p">.</span><span class="n">add</span><span class="o">&lt;</span><span class="kt">size_t</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;--num-devices&quot;</span><span class="p">,</span>
      <span class="s">&quot;Number of GPUs to use for this process. Defaults to length(devices) or 1&quot;</span><span class="p">);</span>
<span class="cp">#ifdef USE_NCCL</span>
  <span class="k">if</span><span class="p">(</span><span class="n">mode_</span> <span class="o">==</span> <span class="n">cli</span><span class="o">::</span><span class="n">mode</span><span class="o">::</span><span class="n">training</span><span class="p">)</span>
    <span class="n">cli</span><span class="p">.</span><span class="n">add</span><span class="o">&lt;</span><span class="kt">bool</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;--no-nccl&quot;</span><span class="p">,</span>
      <span class="s">&quot;Disable inter-GPU communication via NCCL&quot;</span><span class="p">);</span>
<span class="cp">#endif</span>
<span class="cp">#ifdef CUDA_FOUND</span>
  <span class="n">cli</span><span class="p">.</span><span class="n">add</span><span class="o">&lt;</span><span class="kt">size_t</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;--cpu-threads&quot;</span><span class="p">,</span>
      <span class="s">&quot;Use CPU-based computation with this many independent threads, 0 means GPU-based computation&quot;</span><span class="p">,</span>
      <span class="mi">0</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="n">implicit_val</span><span class="p">(</span><span class="s">&quot;1&quot;</span><span class="p">);</span>
<span class="cp">#else</span>
  <span class="n">cli</span><span class="p">.</span><span class="n">add</span><span class="o">&lt;</span><span class="kt">size_t</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;--cpu-threads&quot;</span><span class="p">,</span>
      <span class="s">&quot;Use CPU-based computation with this many independent threads, 0 means GPU-based computation&quot;</span><span class="p">,</span>
      <span class="mi">1</span><span class="p">);</span>
<span class="cp">#endif</span>
  <span class="c1">// clang-format on</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">ConfigParser</span><span class="o">::</span><span class="n">addSuboptionsBatching</span><span class="p">(</span><span class="n">cli</span><span class="o">::</span><span class="n">CLIWrapper</span><span class="o">&amp;</span> <span class="n">cli</span><span class="p">)</span> <span class="p">{</span>
  <span class="kt">int</span> <span class="n">defaultMiniBatch</span> <span class="o">=</span> <span class="p">(</span><span class="n">mode_</span> <span class="o">==</span> <span class="n">cli</span><span class="o">::</span><span class="n">mode</span><span class="o">::</span><span class="n">translation</span><span class="p">)</span> <span class="o">?</span> <span class="mi">1</span> <span class="o">:</span> <span class="mi">64</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">defaultMaxiBatch</span> <span class="o">=</span> <span class="p">(</span><span class="n">mode_</span> <span class="o">==</span> <span class="n">cli</span><span class="o">::</span><span class="n">mode</span><span class="o">::</span><span class="n">translation</span><span class="p">)</span> <span class="o">?</span> <span class="mi">1</span> <span class="o">:</span> <span class="mi">100</span><span class="p">;</span>
  <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">defaultMaxiBatchSort</span> <span class="o">=</span> <span class="p">(</span><span class="n">mode_</span> <span class="o">==</span> <span class="n">cli</span><span class="o">::</span><span class="n">mode</span><span class="o">::</span><span class="n">translation</span><span class="p">)</span> <span class="o">?</span> <span class="s">&quot;none&quot;</span> <span class="o">:</span> <span class="s">&quot;trg&quot;</span><span class="p">;</span>

  <span class="c1">// clang-format off</span>
  <span class="n">cli</span><span class="p">.</span><span class="n">add</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;--mini-batch&quot;</span><span class="p">,</span>
               <span class="c1">// set accurate help messages for translation, scoring, or training</span>
               <span class="p">(</span><span class="n">mode_</span> <span class="o">==</span> <span class="n">cli</span><span class="o">::</span><span class="n">mode</span><span class="o">::</span><span class="n">translation</span><span class="p">)</span>
                   <span class="o">?</span> <span class="s">&quot;Size of mini-batch used during batched translation&quot;</span> <span class="o">:</span>
               <span class="p">(</span><span class="n">mode_</span> <span class="o">==</span> <span class="n">cli</span><span class="o">::</span><span class="n">mode</span><span class="o">::</span><span class="n">scoring</span><span class="p">)</span>
                   <span class="o">?</span> <span class="s">&quot;Size of mini-batch used during batched scoring&quot;</span>
                   <span class="o">:</span> <span class="s">&quot;Size of mini-batch used during update&quot;</span><span class="p">,</span>
               <span class="n">defaultMiniBatch</span><span class="p">);</span>
  <span class="n">cli</span><span class="p">.</span><span class="n">add</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;--mini-batch-words&quot;</span><span class="p">,</span>
      <span class="s">&quot;Set mini-batch size based on words instead of sentences&quot;</span><span class="p">);</span>

  <span class="k">if</span><span class="p">(</span><span class="n">mode_</span> <span class="o">==</span> <span class="n">cli</span><span class="o">::</span><span class="n">mode</span><span class="o">::</span><span class="n">training</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">cli</span><span class="p">.</span><span class="n">add</span><span class="o">&lt;</span><span class="kt">bool</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;--mini-batch-fit&quot;</span><span class="p">,</span>
      <span class="s">&quot;Determine mini-batch size automatically based on sentence-length to fit reserved memory&quot;</span><span class="p">);</span>
    <span class="n">cli</span><span class="p">.</span><span class="n">add</span><span class="o">&lt;</span><span class="kt">size_t</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;--mini-batch-fit-step&quot;</span><span class="p">,</span>
      <span class="s">&quot;Step size for mini-batch-fit statistics&quot;</span><span class="p">,</span>
      <span class="mi">10</span><span class="p">);</span>
    <span class="n">cli</span><span class="p">.</span><span class="n">add</span><span class="o">&lt;</span><span class="kt">bool</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;--gradient-checkpointing&quot;</span><span class="p">,</span>
      <span class="s">&quot;Enable gradient-checkpointing to minimize memory usage&quot;</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="n">cli</span><span class="p">.</span><span class="n">add</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;--maxi-batch&quot;</span><span class="p">,</span>
      <span class="s">&quot;Number of batches to preload for length-based sorting&quot;</span><span class="p">,</span>
      <span class="n">defaultMaxiBatch</span><span class="p">);</span>
  <span class="n">cli</span><span class="p">.</span><span class="n">add</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;--maxi-batch-sort&quot;</span><span class="p">,</span>
      <span class="s">&quot;Sorting strategy for maxi-batch: none, src, trg (not available for decoder)&quot;</span><span class="p">,</span>
      <span class="n">defaultMaxiBatchSort</span><span class="p">);</span>

  <span class="k">if</span><span class="p">(</span><span class="n">mode_</span> <span class="o">==</span> <span class="n">cli</span><span class="o">::</span><span class="n">mode</span><span class="o">::</span><span class="n">training</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">cli</span><span class="p">.</span><span class="n">add</span><span class="o">&lt;</span><span class="kt">bool</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;--shuffle-in-ram&quot;</span><span class="p">,</span>
        <span class="s">&quot;Keep shuffled corpus in RAM, do not write to temp file&quot;</span><span class="p">);</span>
    <span class="c1">// @TODO: Consider making the next two options options of the vocab instead, to make it more local in scope.</span>
    <span class="n">cli</span><span class="p">.</span><span class="n">add</span><span class="o">&lt;</span><span class="kt">size_t</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;--all-caps-every&quot;</span><span class="p">,</span>
        <span class="s">&quot;When forming minibatches, preprocess every Nth line on the fly to all-caps. Assumes UTF-8&quot;</span><span class="p">);</span>
    <span class="n">cli</span><span class="p">.</span><span class="n">add</span><span class="o">&lt;</span><span class="kt">size_t</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;--english-title-case-every&quot;</span><span class="p">,</span>
        <span class="s">&quot;When forming minibatches, preprocess every Nth line on the fly to title-case. Assumes English (ASCII only)&quot;</span><span class="p">);</span>

    <span class="n">cli</span><span class="p">.</span><span class="n">add</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;--mini-batch-words-ref&quot;</span><span class="p">,</span>
        <span class="s">&quot;If given, the following hyper parameters are adjusted as-if we had this mini-batch size: &quot;</span>
        <span class="s">&quot;--learn-rate, --optimizer-params, --exponential-smoothing, --mini-batch-warmup&quot;</span><span class="p">);</span>
    <span class="n">cli</span><span class="p">.</span><span class="n">add</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="cm">/*SchedulerPeriod*/</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;--mini-batch-warmup&quot;</span><span class="p">,</span>
        <span class="s">&quot;Linear ramp-up of MB size, up to this #updates (append &#39;t&#39; for up to this #target labels). &quot;</span>
        <span class="s">&quot;Auto-adjusted to --mini-batch-words-ref if given&quot;</span><span class="p">,</span>
        <span class="p">{</span><span class="s">&quot;0&quot;</span><span class="p">});</span>
    <span class="n">cli</span><span class="p">.</span><span class="n">add</span><span class="o">&lt;</span><span class="kt">bool</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;--mini-batch-track-lr&quot;</span><span class="p">,</span>
        <span class="s">&quot;Dynamically track mini-batch size inverse to actual learning rate (not considering lr-warmup)&quot;</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="c1">// clang-format on</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">ConfigParser</span><span class="o">::</span><span class="n">addSuboptionsInputLength</span><span class="p">(</span><span class="n">cli</span><span class="o">::</span><span class="n">CLIWrapper</span><span class="o">&amp;</span> <span class="n">cli</span><span class="p">)</span> <span class="p">{</span>
  <span class="kt">size_t</span> <span class="n">defaultMaxLength</span> <span class="o">=</span> <span class="p">(</span><span class="n">mode_</span> <span class="o">==</span> <span class="n">cli</span><span class="o">::</span><span class="n">mode</span><span class="o">::</span><span class="n">training</span><span class="p">)</span> <span class="o">?</span> <span class="mi">50</span> <span class="o">:</span> <span class="mi">1000</span><span class="p">;</span>
  <span class="c1">// clang-format off</span>
  <span class="n">cli</span><span class="p">.</span><span class="n">add</span><span class="o">&lt;</span><span class="kt">size_t</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;--max-length&quot;</span><span class="p">,</span>
      <span class="s">&quot;Maximum length of a sentence in a training sentence pair&quot;</span><span class="p">,</span>
      <span class="n">defaultMaxLength</span><span class="p">);</span>
  <span class="n">cli</span><span class="p">.</span><span class="n">add</span><span class="o">&lt;</span><span class="kt">bool</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;--max-length-crop&quot;</span><span class="p">,</span>
      <span class="s">&quot;Crop a sentence to max-length instead of omitting it if longer than max-length&quot;</span><span class="p">);</span>
  <span class="c1">// clang-format on</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">ConfigParser</span><span class="o">::</span><span class="n">addSuboptionsTSV</span><span class="p">(</span><span class="n">cli</span><span class="o">::</span><span class="n">CLIWrapper</span><span class="o">&amp;</span> <span class="n">cli</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// clang-format off</span>
  <span class="n">cli</span><span class="p">.</span><span class="n">add</span><span class="o">&lt;</span><span class="kt">bool</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;--tsv&quot;</span><span class="p">,</span>
      <span class="s">&quot;Tab-separated input&quot;</span><span class="p">);</span>
  <span class="n">cli</span><span class="p">.</span><span class="n">add</span><span class="o">&lt;</span><span class="kt">size_t</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;--tsv-fields&quot;</span><span class="p">,</span>
      <span class="s">&quot;Number of fields in the TSV input. By default, it is guessed based on the model type&quot;</span><span class="p">);</span>
  <span class="c1">// clang-format on</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">ConfigParser</span><span class="o">::</span><span class="n">addSuboptionsULR</span><span class="p">(</span><span class="n">cli</span><span class="o">::</span><span class="n">CLIWrapper</span><span class="o">&amp;</span> <span class="n">cli</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// clang-format off</span>
  <span class="c1">// support for universal encoder ULR https://arxiv.org/pdf/1802.05368.pdf</span>
  <span class="n">cli</span><span class="p">.</span><span class="n">add</span><span class="o">&lt;</span><span class="kt">bool</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;--ulr&quot;</span><span class="p">,</span>
      <span class="s">&quot;Enable ULR (Universal Language Representation)&quot;</span><span class="p">);</span>
  <span class="c1">// reading pre-trained universal embeddings for multi-sources.</span>
  <span class="c1">// Note that source and target here is relative to ULR not the translation langs</span>
  <span class="c1">// queries: EQ in Fig2 : is the unified embeddings projected to one space.</span>
  <span class="n">cli</span><span class="p">.</span><span class="n">add</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;--ulr-query-vectors&quot;</span><span class="p">,</span>
      <span class="s">&quot;Path to file with universal sources embeddings from projection into universal space&quot;</span><span class="p">,</span>
      <span class="s">&quot;&quot;</span><span class="p">);</span>
  <span class="c1">// keys: EK in Fig2 : is the keys of the target embbedings projected to unified space (i.e. ENU in</span>
  <span class="c1">// multi-lingual case)</span>
  <span class="n">cli</span><span class="p">.</span><span class="n">add</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;--ulr-keys-vectors&quot;</span><span class="p">,</span>
      <span class="s">&quot;Path to file with universal sources embeddings of traget keys from projection into universal space&quot;</span><span class="p">,</span>
      <span class="s">&quot;&quot;</span><span class="p">);</span>
  <span class="n">cli</span><span class="p">.</span><span class="n">add</span><span class="o">&lt;</span><span class="kt">bool</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;--ulr-trainable-transformation&quot;</span><span class="p">,</span>
      <span class="s">&quot;Make Query Transformation Matrix A trainable&quot;</span><span class="p">);</span>
  <span class="n">cli</span><span class="p">.</span><span class="n">add</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;--ulr-dim-emb&quot;</span><span class="p">,</span>
      <span class="s">&quot;ULR monolingual embeddings dimension&quot;</span><span class="p">);</span>
  <span class="n">cli</span><span class="p">.</span><span class="n">add</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;--ulr-dropout&quot;</span><span class="p">,</span>
      <span class="s">&quot;ULR dropout on embeddings attentions. Default is no dropout&quot;</span><span class="p">,</span>
      <span class="mf">0.0f</span><span class="p">);</span>
  <span class="n">cli</span><span class="p">.</span><span class="n">add</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;--ulr-softmax-temperature&quot;</span><span class="p">,</span>
      <span class="s">&quot;ULR softmax temperature to control randomness of predictions. Deafult is 1.0: no temperature&quot;</span><span class="p">,</span>
      <span class="mf">1.0f</span><span class="p">);</span>
  <span class="c1">// clang-format on</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">ConfigParser</span><span class="o">::</span><span class="n">addSuboptionsQuantization</span><span class="p">(</span><span class="n">cli</span><span class="o">::</span><span class="n">CLIWrapper</span><span class="o">&amp;</span> <span class="n">cli</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// clang-format off</span>
  <span class="c1">// model quantization training</span>
  <span class="n">cli</span><span class="p">.</span><span class="n">add</span><span class="o">&lt;</span><span class="kt">size_t</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;--quantize-bits&quot;</span><span class="p">,</span>
     <span class="s">&quot;Number of bits to compress model to. Set to 0 to disable&quot;</span><span class="p">,</span>
      <span class="mi">0</span><span class="p">);</span>
  <span class="n">cli</span><span class="p">.</span><span class="n">add</span><span class="o">&lt;</span><span class="kt">size_t</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;--quantize-optimization-steps&quot;</span><span class="p">,</span>
     <span class="s">&quot;Adjust quantization scaling factor for N steps&quot;</span><span class="p">,</span>
     <span class="mi">0</span><span class="p">);</span>
  <span class="n">cli</span><span class="p">.</span><span class="n">add</span><span class="o">&lt;</span><span class="kt">bool</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;--quantize-log-based&quot;</span><span class="p">,</span>
     <span class="s">&quot;Uses log-based quantization&quot;</span><span class="p">);</span>
  <span class="n">cli</span><span class="p">.</span><span class="n">add</span><span class="o">&lt;</span><span class="kt">bool</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;--quantize-biases&quot;</span><span class="p">,</span>
     <span class="s">&quot;Apply quantization to biases&quot;</span><span class="p">);</span>
  <span class="c1">// clang-format on</span>
<span class="p">}</span>

<span class="n">cli</span><span class="o">::</span><span class="n">mode</span> <span class="n">ConfigParser</span><span class="o">::</span><span class="n">getMode</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="n">mode_</span><span class="p">;</span> <span class="p">}</span>

<span class="n">Ptr</span><span class="o">&lt;</span><span class="n">Options</span><span class="o">&gt;</span> <span class="n">ConfigParser</span><span class="o">::</span><span class="n">parseOptions</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span><span class="o">**</span> <span class="n">argv</span><span class="p">,</span> <span class="kt">bool</span> <span class="n">doValidate</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">cmdLine_</span> <span class="o">=</span> <span class="n">escapeCmdLine</span><span class="p">(</span><span class="n">argc</span><span class="p">,</span><span class="n">argv</span><span class="p">);</span>

  <span class="c1">// parse command-line options and fill wrapped YAML config</span>
  <span class="n">cli_</span><span class="p">.</span><span class="n">parse</span><span class="p">(</span><span class="n">argc</span><span class="p">,</span> <span class="n">argv</span><span class="p">);</span>

  <span class="k">if</span><span class="p">(</span><span class="n">get</span><span class="o">&lt;</span><span class="kt">bool</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;authors&quot;</span><span class="p">))</span> <span class="p">{</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cerr</span> <span class="o">&lt;&lt;</span> <span class="n">authors</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
    <span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="k">if</span><span class="p">(</span><span class="n">get</span><span class="o">&lt;</span><span class="kt">bool</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;cite&quot;</span><span class="p">))</span> <span class="p">{</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cerr</span> <span class="o">&lt;&lt;</span> <span class="n">citation</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
    <span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="k">auto</span> <span class="n">buildInfo</span> <span class="o">=</span> <span class="n">get</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;build-info&quot;</span><span class="p">);</span>
  <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">buildInfo</span><span class="p">.</span><span class="n">empty</span><span class="p">()</span> <span class="o">&amp;&amp;</span> <span class="n">buildInfo</span> <span class="o">!=</span> <span class="s">&quot;false&quot;</span><span class="p">)</span> <span class="p">{</span>
<span class="cp">#ifndef _MSC_VER </span><span class="c1">// cmake build options are not available on MSVC based build.</span>
    <span class="k">if</span><span class="p">(</span><span class="n">buildInfo</span> <span class="o">==</span> <span class="s">&quot;all&quot;</span><span class="p">)</span>
      <span class="n">std</span><span class="o">::</span><span class="n">cerr</span> <span class="o">&lt;&lt;</span> <span class="n">cmakeBuildOptionsAdvanced</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
    <span class="k">else</span>
      <span class="n">std</span><span class="o">::</span><span class="n">cerr</span> <span class="o">&lt;&lt;</span> <span class="n">cmakeBuildOptions</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
    <span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<span class="cp">#else </span><span class="c1">// _MSC_VER</span>
    <span class="n">ABORT</span><span class="p">(</span><span class="s">&quot;build-info is not available on MSVC based build.&quot;</span><span class="p">);</span>
<span class="cp">#endif </span><span class="c1">// _MSC_VER</span>
  <span class="p">}</span>

  <span class="c1">// get paths to extra config files</span>
  <span class="k">auto</span> <span class="n">configPaths</span> <span class="o">=</span> <span class="n">findConfigPaths</span><span class="p">();</span>
  <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">configPaths</span><span class="p">.</span><span class="n">empty</span><span class="p">())</span> <span class="p">{</span>
    <span class="k">auto</span> <span class="n">config</span> <span class="o">=</span> <span class="n">loadConfigFiles</span><span class="p">(</span><span class="n">configPaths</span><span class="p">);</span>
    <span class="n">cli_</span><span class="p">.</span><span class="n">updateConfig</span><span class="p">(</span><span class="n">config</span><span class="p">,</span>
                     <span class="n">cli</span><span class="o">::</span><span class="n">OptionPriority</span><span class="o">::</span><span class="n">ConfigFile</span><span class="p">,</span>
                     <span class="s">&quot;There are option(s) in a config file that are not expected&quot;</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="k">if</span><span class="p">(</span><span class="n">get</span><span class="o">&lt;</span><span class="kt">bool</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;interpolate-env-vars&quot;</span><span class="p">))</span> <span class="p">{</span>
    <span class="n">cli</span><span class="o">::</span><span class="n">processPaths</span><span class="p">(</span><span class="n">config_</span><span class="p">,</span> <span class="n">cli</span><span class="o">::</span><span class="n">interpolateEnvVars</span><span class="p">,</span> <span class="n">PATHS</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="c1">// Option shortcuts for input from STDIN for trainer and scorer</span>
  <span class="k">if</span><span class="p">(</span><span class="n">mode_</span> <span class="o">==</span> <span class="n">cli</span><span class="o">::</span><span class="n">mode</span><span class="o">::</span><span class="n">training</span> <span class="o">||</span> <span class="n">mode_</span> <span class="o">==</span> <span class="n">cli</span><span class="o">::</span><span class="n">mode</span><span class="o">::</span><span class="n">scoring</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">auto</span> <span class="n">trainSets</span> <span class="o">=</span> <span class="n">get</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;&gt;</span><span class="p">(</span><span class="s">&quot;train-sets&quot;</span><span class="p">);</span>
    <span class="n">YAML</span><span class="o">::</span><span class="n">Node</span> <span class="n">config</span><span class="p">;</span>
    <span class="c1">// Assume the input will come from STDIN if --tsv is set but no --train-sets are given</span>
    <span class="k">if</span><span class="p">(</span><span class="n">get</span><span class="o">&lt;</span><span class="kt">bool</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;tsv&quot;</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="n">trainSets</span><span class="p">.</span><span class="n">empty</span><span class="p">())</span> <span class="p">{</span>
      <span class="n">config</span><span class="p">[</span><span class="s">&quot;train-sets&quot;</span><span class="p">].</span><span class="n">push_back</span><span class="p">(</span><span class="s">&quot;stdin&quot;</span><span class="p">);</span>
    <span class="c1">// Assume the input is in TSV format if --train-sets is set to &quot;stdin&quot;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">trainSets</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">==</span> <span class="mi">1</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">trainSets</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s">&quot;stdin&quot;</span> <span class="o">||</span> <span class="n">trainSets</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s">&quot;-&quot;</span><span class="p">))</span> <span class="p">{</span>
      <span class="n">config</span><span class="p">[</span><span class="s">&quot;tsv&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">config</span><span class="p">.</span><span class="n">IsNull</span><span class="p">())</span>
      <span class="n">cli_</span><span class="p">.</span><span class="n">updateConfig</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">cli</span><span class="o">::</span><span class="n">OptionPriority</span><span class="o">::</span><span class="n">CommandLine</span><span class="p">,</span> <span class="s">&quot;A shortcut for STDIN failed.&quot;</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="k">if</span><span class="p">(</span><span class="n">doValidate</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">ConfigValidator</span><span class="p">(</span><span class="n">config_</span><span class="p">).</span><span class="n">validateOptions</span><span class="p">(</span><span class="n">mode_</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="c1">// remove extra config files from the config to avoid redundancy</span>
  <span class="n">config_</span><span class="p">.</span><span class="n">remove</span><span class="p">(</span><span class="s">&quot;config&quot;</span><span class="p">);</span>

  <span class="c1">// dump config and exit</span>
  <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">get</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;dump-config&quot;</span><span class="p">).</span><span class="n">empty</span><span class="p">()</span> <span class="o">&amp;&amp;</span> <span class="n">get</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;dump-config&quot;</span><span class="p">)</span> <span class="o">!=</span> <span class="s">&quot;false&quot;</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">auto</span> <span class="n">dumpMode</span> <span class="o">=</span> <span class="n">get</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;dump-config&quot;</span><span class="p">);</span>
    <span class="n">config_</span><span class="p">.</span><span class="n">remove</span><span class="p">(</span><span class="s">&quot;dump-config&quot;</span><span class="p">);</span>

    <span class="k">if</span><span class="p">(</span><span class="n">dumpMode</span> <span class="o">==</span> <span class="s">&quot;expand&quot;</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">cli_</span><span class="p">.</span><span class="n">parseAliases</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="kt">bool</span> <span class="n">minimal</span> <span class="o">=</span> <span class="p">(</span><span class="n">dumpMode</span> <span class="o">==</span> <span class="s">&quot;minimal&quot;</span> <span class="o">||</span> <span class="n">dumpMode</span> <span class="o">==</span> <span class="s">&quot;expand&quot;</span><span class="p">);</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">cli_</span><span class="p">.</span><span class="n">dumpConfig</span><span class="p">(</span><span class="n">minimal</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
    <span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="c1">// For TSV input, it is possible to use --input-types to determine fields that contain alignments</span>
  <span class="c1">// or weights. In such case, the position of &#39;alignment&#39; input type in --input-types determines</span>
  <span class="c1">// the index of a TSV field that contains word alignments, and respectively, the position of</span>
  <span class="c1">// &#39;weight&#39; in --input-types determines the index of a TSV field that contains weights.</span>
  <span class="c1">// Marian will abort if both the --guided-alignment and &#39;alignment&#39; in --input-types are specified</span>
  <span class="c1">// (or --data-weighting and &#39;weight&#39;).</span>
  <span class="c1">//</span>
  <span class="c1">// Note: this may modify the config, so it is safer to do it after --dump-config.</span>
  <span class="k">if</span><span class="p">(</span><span class="n">mode_</span> <span class="o">==</span> <span class="n">cli</span><span class="o">::</span><span class="n">mode</span><span class="o">::</span><span class="n">training</span> <span class="o">||</span> <span class="n">get</span><span class="o">&lt;</span><span class="kt">bool</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;tsv&quot;</span><span class="p">))</span> <span class="p">{</span>
    <span class="k">auto</span> <span class="n">inputTypes</span> <span class="o">=</span> <span class="n">get</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;&gt;</span><span class="p">(</span><span class="s">&quot;input-types&quot;</span><span class="p">);</span>
    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">inputTypes</span><span class="p">.</span><span class="n">empty</span><span class="p">())</span> <span class="p">{</span>
      <span class="kt">bool</span> <span class="n">seenAligns</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
      <span class="kt">bool</span> <span class="n">seenWeight</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
      <span class="n">YAML</span><span class="o">::</span><span class="n">Node</span> <span class="n">config</span><span class="p">;</span>
      <span class="k">for</span><span class="p">(</span><span class="kt">size_t</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">inputTypes</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span><span class="p">(</span><span class="n">inputTypes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="s">&quot;alignment&quot;</span><span class="p">)</span> <span class="p">{</span>
          <span class="n">ABORT_IF</span><span class="p">(</span><span class="n">seenAligns</span><span class="p">,</span> <span class="s">&quot;You can specify &#39;alignment&#39; only once in input-types&quot;</span><span class="p">);</span>
          <span class="n">ABORT_IF</span><span class="p">(</span><span class="n">has</span><span class="p">(</span><span class="s">&quot;guided-alignment&quot;</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="n">get</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;guided-alignment&quot;</span><span class="p">)</span> <span class="o">!=</span> <span class="s">&quot;none&quot;</span><span class="p">,</span>
                   <span class="s">&quot;You must use either guided-alignment or &#39;alignment&#39; in input-types&quot;</span><span class="p">);</span>
          <span class="n">config</span><span class="p">[</span><span class="s">&quot;guided-alignment&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">to_string</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
          <span class="n">seenAligns</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">if</span><span class="p">(</span><span class="n">inputTypes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="s">&quot;weight&quot;</span><span class="p">)</span> <span class="p">{</span>
          <span class="n">ABORT_IF</span><span class="p">(</span><span class="n">seenWeight</span><span class="p">,</span> <span class="s">&quot;You can specify &#39;weight&#39; only once in input-types&quot;</span><span class="p">);</span>
          <span class="n">ABORT_IF</span><span class="p">(</span><span class="n">has</span><span class="p">(</span><span class="s">&quot;data-weighting&quot;</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">get</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;data-weighting&quot;</span><span class="p">).</span><span class="n">empty</span><span class="p">(),</span>
                   <span class="s">&quot;You must use either data-weighting or &#39;weight&#39; in input-types&quot;</span><span class="p">);</span>
          <span class="n">config</span><span class="p">[</span><span class="s">&quot;data-weighting&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">to_string</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
          <span class="n">seenWeight</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
        <span class="p">}</span>
      <span class="p">}</span>
      <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">config</span><span class="p">.</span><span class="n">IsNull</span><span class="p">())</span>
        <span class="n">cli_</span><span class="p">.</span><span class="n">updateConfig</span><span class="p">(</span><span class="n">config</span><span class="p">,</span>
                          <span class="n">cli</span><span class="o">::</span><span class="n">OptionPriority</span><span class="o">::</span><span class="n">CommandLine</span><span class="p">,</span>
                          <span class="s">&quot;Extracting &#39;alignment&#39; and &#39;weight&#39; types from input-types failed.&quot;</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="n">cli_</span><span class="p">.</span><span class="n">parseAliases</span><span class="p">();</span>
  <span class="k">auto</span> <span class="n">opts</span> <span class="o">=</span> <span class="n">New</span><span class="o">&lt;</span><span class="n">Options</span><span class="o">&gt;</span><span class="p">();</span>
  <span class="n">opts</span><span class="o">-&gt;</span><span class="n">merge</span><span class="p">(</span><span class="n">Config</span><span class="p">(</span><span class="o">*</span><span class="k">this</span><span class="p">).</span><span class="n">get</span><span class="p">());</span>
  <span class="k">return</span> <span class="n">opts</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span> <span class="n">ConfigParser</span><span class="o">::</span><span class="n">findConfigPaths</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span> <span class="n">paths</span><span class="p">;</span>

  <span class="kt">bool</span> <span class="n">interpolateEnvVars</span> <span class="o">=</span> <span class="n">get</span><span class="o">&lt;</span><span class="kt">bool</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;interpolate-env-vars&quot;</span><span class="p">);</span>
  <span class="kt">bool</span> <span class="n">loadConfig</span> <span class="o">=</span> <span class="o">!</span><span class="n">config_</span><span class="p">[</span><span class="s">&quot;config&quot;</span><span class="p">].</span><span class="n">as</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;&gt;</span><span class="p">().</span><span class="n">empty</span><span class="p">();</span>

  <span class="k">if</span><span class="p">(</span><span class="n">loadConfig</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">paths</span> <span class="o">=</span> <span class="n">config_</span><span class="p">[</span><span class="s">&quot;config&quot;</span><span class="p">].</span><span class="n">as</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;&gt;</span><span class="p">();</span>
    <span class="k">for</span><span class="p">(</span><span class="k">auto</span><span class="o">&amp;</span> <span class="nl">path</span> <span class="p">:</span> <span class="n">paths</span><span class="p">)</span> <span class="p">{</span>
      <span class="c1">// (note: this updates the paths array)</span>
      <span class="k">if</span><span class="p">(</span><span class="n">interpolateEnvVars</span><span class="p">)</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">cli</span><span class="o">::</span><span class="n">interpolateEnvVars</span><span class="p">(</span><span class="n">path</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span> <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">mode_</span> <span class="o">==</span> <span class="n">cli</span><span class="o">::</span><span class="n">mode</span><span class="o">::</span><span class="n">training</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">auto</span> <span class="n">path</span> <span class="o">=</span> <span class="n">config_</span><span class="p">[</span><span class="s">&quot;model&quot;</span><span class="p">].</span><span class="n">as</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span><span class="p">()</span> <span class="o">+</span> <span class="s">&quot;.yml&quot;</span><span class="p">;</span>
    <span class="k">if</span><span class="p">(</span><span class="n">interpolateEnvVars</span><span class="p">)</span>
      <span class="n">path</span> <span class="o">=</span> <span class="n">cli</span><span class="o">::</span><span class="n">interpolateEnvVars</span><span class="p">(</span><span class="n">path</span><span class="p">);</span>

    <span class="kt">bool</span> <span class="n">reloadConfig</span> <span class="o">=</span> <span class="n">filesystem</span><span class="o">::</span><span class="n">exists</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">get</span><span class="o">&lt;</span><span class="kt">bool</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;no-reload&quot;</span><span class="p">);</span>
    <span class="k">if</span><span class="p">(</span><span class="n">reloadConfig</span><span class="p">)</span>
      <span class="n">paths</span> <span class="o">=</span> <span class="p">{</span><span class="n">path</span><span class="p">};</span>
  <span class="p">}</span>

  <span class="k">return</span> <span class="n">paths</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">YAML</span><span class="o">::</span><span class="n">Node</span> <span class="n">ConfigParser</span><span class="o">::</span><span class="n">loadConfigFiles</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;&amp;</span> <span class="n">paths</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">YAML</span><span class="o">::</span><span class="n">Node</span> <span class="n">configAll</span><span class="p">;</span>

  <span class="k">for</span><span class="p">(</span><span class="k">auto</span><span class="o">&amp;</span> <span class="nl">path</span> <span class="p">:</span> <span class="n">paths</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// load single config file</span>
    <span class="n">io</span><span class="o">::</span><span class="n">InputFileStream</span> <span class="n">strm</span><span class="p">(</span><span class="n">path</span><span class="p">);</span>
    <span class="n">YAML</span><span class="o">::</span><span class="n">Node</span> <span class="n">config</span> <span class="o">=</span> <span class="n">YAML</span><span class="o">::</span><span class="n">Load</span><span class="p">(</span><span class="n">strm</span><span class="p">);</span>

    <span class="c1">// expand relative paths if requested</span>
    <span class="k">if</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s">&quot;relative-paths&quot;</span><span class="p">]</span> <span class="o">&amp;&amp;</span> <span class="n">config</span><span class="p">[</span><span class="s">&quot;relative-paths&quot;</span><span class="p">].</span><span class="n">as</span><span class="o">&lt;</span><span class="kt">bool</span><span class="o">&gt;</span><span class="p">())</span> <span class="p">{</span>
      <span class="c1">// interpolate environment variables if requested in this config file or</span>
      <span class="c1">// via command-line options</span>
      <span class="kt">bool</span> <span class="n">interpolateEnvVars</span> <span class="o">=</span> <span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s">&quot;interpolate-env-vars&quot;</span><span class="p">]</span>
                                 <span class="o">&amp;&amp;</span> <span class="n">config</span><span class="p">[</span><span class="s">&quot;interpolate-env-vars&quot;</span><span class="p">].</span><span class="n">as</span><span class="o">&lt;</span><span class="kt">bool</span><span class="o">&gt;</span><span class="p">())</span>
                                <span class="o">||</span> <span class="n">get</span><span class="o">&lt;</span><span class="kt">bool</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;interpolate-env-vars&quot;</span><span class="p">);</span>
      <span class="k">if</span><span class="p">(</span><span class="n">interpolateEnvVars</span><span class="p">)</span>
        <span class="n">cli</span><span class="o">::</span><span class="n">processPaths</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">cli</span><span class="o">::</span><span class="n">interpolateEnvVars</span><span class="p">,</span> <span class="n">PATHS</span><span class="p">);</span>

      <span class="c1">// replace relative path w.r.t. the config file</span>
      <span class="n">cli</span><span class="o">::</span><span class="n">makeAbsolutePaths</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">PATHS</span><span class="p">);</span>
      <span class="c1">// remove &#39;relative-paths&#39; and do not spread it into other config files</span>
      <span class="n">config</span><span class="p">.</span><span class="n">remove</span><span class="p">(</span><span class="s">&quot;relative-paths&quot;</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="c1">// merge with previous config files, later file overrides earlier</span>
    <span class="k">for</span><span class="p">(</span><span class="k">const</span> <span class="k">auto</span><span class="o">&amp;</span> <span class="nl">it</span> <span class="p">:</span> <span class="n">config</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">configAll</span><span class="p">[</span><span class="n">it</span><span class="p">.</span><span class="n">first</span><span class="p">.</span><span class="n">as</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span><span class="p">()]</span> <span class="o">=</span> <span class="n">YAML</span><span class="o">::</span><span class="n">Clone</span><span class="p">(</span><span class="n">it</span><span class="p">.</span><span class="n">second</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="k">return</span> <span class="n">configAll</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">const</span> <span class="n">YAML</span><span class="o">::</span><span class="n">Node</span><span class="o">&amp;</span> <span class="n">ConfigParser</span><span class="o">::</span><span class="n">getConfig</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span>
  <span class="k">return</span> <span class="n">config_</span><span class="p">;</span>
<span class="p">}</span>
<span class="p">}</span>  <span class="c1">// namespace marian</span>
</pre></div>
</div>
</div>


           </div>
           
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2021, Marian NMT Team.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>